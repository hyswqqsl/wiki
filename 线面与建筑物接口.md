# 线面与建筑物接口



## 一 建筑物控制层，ShapeController
1. BIM取得建筑物详情，/shape/bim/build/{id},GET
   * BIM取得建筑物详情，用于显示建筑物三维模型
   * 参数：
       * id：建筑物id
   * 返回：
       * OK，建筑物的属性json，包含id，name，type，属性由alias和value组成，参考下面的 BIM json
2. 获取所有图形线面类型, /shape/shape/type/download,GET
   * 返回所有线面类型，返回json数组
   * 参数：无
   * 返回：OK，[{"line","公共线面","ggxm","线",false},{...}]    
3. 图形线面模板下载, /shape/shape/template/download,GET
   * 根据选择的线面类型下载模板excel，每个sheet是一个类型的模板
   * 参数：
       * types：线面枚举英文名的json:["ggxm","zlfw","..."]
   * 返回：
       * OK,自动保存未excel
4. 上传图形线面,/shape/shape/upload,POST
    * 参数：
        * projectId:项目id
        * baseLevelType:基准面类型
        * WGS84Type:WGS84坐标格式
        * fileName:file对象若干个
    * 返回：
        * OK：上传成功；
        * COOR_FORMAT_ERROR：上传失败:坐标文件或格式错误;
        * COOR_PROJECT_NO_CENTER：中心坐标点(行政区)未选择
        * COOR_RETURN_PROMPT: 上传过程有问题，返回相应提示信息，前台显示这些问题描述
        * EXPIRED：您当前的套餐已过期，请重新购买
5. 图形线面下载,/shape/shape/download,GET
    * 下载项目下的所有线面
    * 每个sheet是一个线面类型
    * 参数:
        * projectId:项目id
    * 返回:
        * OK，下载成功
6. 获取图形线面详情, /shape/shape/details,GET
   * 取得确定线面json结构
   * 参数：id：线面id
   * 返回：
       * OK，取得线面json，包含线面支持的剖面类型(attributeTypes:[{type(枚举英文):"xxx",text(枚举中文):"xxx"},"..."])
       * DATA_NOEXIST, 线面不存在
       * DATA_REFUSE：不是自己的线面
7. 新建图形线面, /shape/shape/create, POST
   * 用户在web端绘图时，新建线面
   * 参数：
      * projectId: 项目id
      * type: 线面类型，使用英文名称
      * remark: 备注
      * coors: 坐标，json:[{lat:xxx, lon:xxx ele: xxx}, {...}] 
   * 返回：
      * OK，新建成功
8. 编辑图形线面, /shape/shape/edit, POST
   * 用户在web端绘图时，编辑线面
   * 绘图时，只传递修改过的点，比如修改了A点位置，那么只传递A点信息
   * 如果在A点后添加点，需要传递添加A点和添加的点信息
   * 参数：
      * coors: [{id:xxx,lat:xxx,lon:xxx,ele:xxx}, {lat:xxx,lon:xxx,ele:xxx}]
   * 返回：
      * OK，编辑成功
      * DATA_REFUSE：不是自己的线面      
9. 删除图形线面, /shape/shape/delete/{id},DELETE
   * 用户在绘图，工程布置里，都可以删除线面
   * 删除线面时，注意把线面下属性，线面下的点，点下的建筑物，建筑物下的属性都要删除
   * 参数：id：线面id
   * 返回：
      * OK：删除成功
      * DATA_NOEXIST: 线面不存在
      * DATA_REFUSE：不是自己的线面
10. 删除图形线面下的某点,/shape/shape/coordinate/delete{id},DELETE
   * 用户在工程布置里，删除线面下的某点
   * 删除线面下的点，点下的建筑物，建筑物下的属性都要删除
   * 参数：id：线面点id
   * 返回：
      * OK：删除成功
      * DATA_NOEXIST: 点不存在
      * DATA_REFUSE：不是自己的线面下的点
11. 新建图形线面剖面属性,/shape/shape/attribute/create,GET
   * 用户取得线面详情后，
7. 获取建筑物类型,/shape/buildTemplateInfo,GET
   * 返回所有线面类型，返回json数组
   * 参数：无
   * 返回：OK，[{"buildModel","排气井","pqj","管道建筑物",false}, {...}]
8. 建筑物模板下载,/shape/downloadBuildModel,GET
   * 根据选择的线面类型下载模板excel，每个sheet是一个类型的模板
   * 参数：
       * types：线面枚举英文名的json:["pqj","fsj","..."]
   * 返回：
       * OK,自动保存未excel
9. 单建筑物上传,/shape/single/uploadBuild,POST
   * 只上传excel文件的第一个sheet，建筑物类型就是这个sheet的类型
   * 如果点下有建筑物，那么删除这个建筑物，重新建立新的建筑物
   * 参数：
       * shapeCoordinateId:线面上的点id
       * baseLevelType:基准面类型
       * WGS84Type:WGS84坐标格式
       * file：上传的excel文件
   * 返回：
       * OK: 上传成功
       * COOR_FORMAT_ERROR：上传失败:坐标文件或格式错误;
       * COOR_RETURN_PROMPT: 上传过程有问题，返回相应提示信息，前台显示这些问题描述    
10. 多建筑物上传,/shape/multiple/uploadBuild,POST
   * 可上传多个excel，每个excel包含多个sheet
   * sheet中的中心坐标用于匹配线面上的点，如果匹配上，建筑物就挂在这个点下
   * 如果有匹配不上的建筑物，返回COOR_RETURN_PROMPT
   * 参数：
       * shapeId:线面id
       * baseLevelType:基准面类型
       * WGS84Type:WGS84坐标格式
       * fileName:file对象若干个
   * 返回：
       * OK: 上传成功
       * COOR_FORMAT_ERROR：上传失败:坐标文件或格式错误;
       * COOR_RETURN_PROMPT: 上传过程有问题，返回相应提示信息，前台显示这些问题描述     
        
```
BIM json
{
  "id":1093,
  "name":"3#",
  "tyep":"消力池",
  "center": "102.3,65.4,0",
  "position": "102.34,65.45,0",
  "designElevation": 1.34,
  "remark": "测试",
  "wr00013": 12.4,
  "wr00014": 1.56,
  "wr00015": 1.1,
  "wr00016": 0.56,
  "ct0001": "混凝土",
  "ct0022": "混凝土"
}
```       


## 二 BIM测试
/testBuild/buildTemplateInfo    get   获取模板
/testBuild/uploadBuild   (type  childType ) post   上传建筑物
/testBuild/downloadBuild?type&&childType   get   下载建筑物
/testBuild/bim/build?type&&childType   get  bim获取建筑物信息
/testBuild/build?type&&childType  get     前台获取建筑信息
以上接口type或者chileType不存在，传空字符串
/testBuild/downloadBuildModel?types=,,,  get     下载模板    同一建筑物有childType只传childType，无childType，传type（commonType）  
