# 线面与建筑物接口

![Main](/uploads/2e26f66f04cd4e3bd5c03c0c61974b38/Main.png)



## 一 建筑物控制层，ShapeController
1. BIM取得建筑物详情，/shape/bim/build/{id},GET
   * BIM取得建筑物详情，用于显示建筑物三维模型
   * 参数：
       * id：建筑物id
   * 返回：
       * OK，建筑物的属性json，包含id，name，type，属性由alias和value组成，参考下面的 BIM json
2. 获取所有图形线面类型, /shape/shape/type/download,GET
   * 返回所有线面类型，返回json数组
   * 参数：无
   * 返回：OK，[{"line","公共线面","ggxm","线"},{...}]    
3. 图形线面模板下载, /shape/shape/template/download,GET
   * 根据选择的线面类型下载模板excel，每个sheet是一个类型的模板
   * 线面模板有经纬度，高程，还有高程组
   * 参数：
       * types：字符串，线面枚举逗号隔开:"ggxm","zlfw","..."
   * 返回：
       * OK,自动保存未excel
4. 上传图形线面,/shape/shape/upload,POST
    * 上传的excel文件每行要填写经纬度，高程，还有高程组
    * 如果没有填写高程组，上传后点高程组值为0，BIM显示时是一条线，没有剖面的高程变化
    * 参数：
        * projectId:项目id
        * baseLevelType:基准面类型
        * WGS84Type:WGS84坐标格式
        * fileName:file对象若干个
    * 返回：
        * OK：上传成功；
        * COOR_FORMAT_ERROR：上传失败:坐标文件或格式错误;
        * COOR_PROJECT_NO_CENTER：中心坐标点(行政区)未选择
        * COOR_RETURN_PROMPT: 上传过程有问题，返回相应提示信息，前台显示这些问题描述
        * EXPIRED：您当前的套餐已过期，请重新购买
5. 图形线面下载,/shape/shape/download,GET
    * 下载项目下的所有线面
    * 线面每个点有经纬度，高程，还有高程组
    * 每个sheet是一个线面类型
    * 参数:
        * projectId:项目id
    * 返回:
        * OK，下载成功
6. 获取图形线面详情, /shape/shape/details/{id},GET
   * 取得确定线面json结构
   * 参数：id：线面id
   * 如果没有新建剖面类型需要把所有剖面类型发过来，childTypes:[{type(枚举英文):"xxx",text(枚举中文):"xxx"},"..."]
   * 返回：
       * OK
          * 线面属性：{id:xxx,type:xxx,remark:xxx}
          * 线面coors,如果点下建筑物，需要把建筑物名发过来, coors:[{id:xxx,lat:xxx,lon:xxx,ele:xxx, buildName:xxx}, {...}]
          * childType：剖面类型
          * 包含剖面属性：attributes:[{id:xxx,alias:xxx, name:xxx}, {...}]
       * DATA_NOEXIST, 线面不存在
       * DATA_REFUSE：不是自己的线面
7. 新建图形线面, /shape/shape/create, POST
   * 用户在web端绘图时，新建线面
   * 新建的图形线面中每个点，高程组已确定，只是值都是0
   * 如果给点的高程组填写值，需要先把线面下载下来，给每个点填写高程组值，再上传
   * 参数：
      * projectId: 项目id
      * type: 线面类型，使用英文名称
      * remark: 备注
      * coors: 坐标，json:[{lat:xxx, lon:xxx ele: xxx}, {...}] 
   * 返回：
      * OK，新建成功
         * 取得线面json
         * 线面属性：{id:xxx,type:xxx,remark:xxx}
         * 线面coors: coors:[{id:xxx,lat:xxx,lon:xxx,ele:xxx}, {...}]
         * 包含线面支持的剖面类型：attributeTypes:[{type(枚举英文):"xxx",text(枚举中文):"xxx"},"..."]
         * 包含剖面属性：attributes:[{id:xxx,alias:xxx, name:xxx}, {...}]
8. 编辑图形线面, /shape/shape/edit, POST
   * 用户在web端绘图时，编辑线面
   * 绘图时，只传递修改过的点，比如修改了A点位置，那么只传递A点信息
   * 如果在A点后添加点，需要传递添加A点和添加的点信息,添加的点高程组内的值都是0
   * 参数：
      * id: 线面id
      * remark: 备注
      * coors: [{id:xxx,lat:xxx,lon:xxx,ele:xxx}, {lat:xxx,lon:xxx,ele:xxx}]
   * 返回：
      * OK，编辑成功
         * 取得线面json
         * 线面属性：{id:xxx,type:xxx,remark:xxx}
         * 线面coors: coors:[{id:xxx,lat:xxx,lon:xxx,ele:xxx}, {...}]
         * 包含线面支持的剖面类型：attributeTypes:[{type(枚举英文):"xxx",text(枚举中文):"xxx"},"..."]
         * 包含剖面属性：attributes:[{id:xxx,alias:xxx, name:xxx}, {...}]      
      * DATA_REFUSE：不是自己的线面      
9. 删除图形线面, /shape/shape/delete/{id},DELETE
   * 用户在绘图，工程布置里，都可以删除线面
   * 删除线面时，注意把线面下属性，线面下的点，点下的建筑物，建筑物下的属性都要删除
   * 参数：id：线面id
   * 返回：
      * OK：删除成功
      * DATA_NOEXIST: 线面不存在
      * DATA_REFUSE：不是自己的线面
10. 删除图形线面下的某点,/shape/coordinate/delete/{id},DELETE
   * 用户在工程布置里，删除线面下的某点
   * 删除线面下的点，点下的建筑物，建筑物下的属性都要删除
   * 参数：id：线面点id
   * 返回：
      * OK：删除成功
      * DATA_NOEXIST: 点不存在
      * DATA_REFUSE：不是自己的线面下的点
11. 取得图形线面下某点详情,/shape/coordinate/details/{id},GET
   * 用户在工程布置里，选择一个点，返回点的详情
   * 返回的建筑物基本信息，包含id,type,name，如果要看建筑物详情，再点击建筑物调用建筑物详情接口
   * 参数： id：线面点id
   * 返回：
      * OK：点属性，高程组，建筑物基本信息
         * {id:xxx,lat:xxx,lon:xxx,elevations:[{top-ele:xxx,name:xxx,value:xxx},{...}],build:{id:xxx,type:xxx,name:xxx}}
      * DATA_NOEXIST: 点不存在
      * DATA_REFUSE：不是自己的线面下的点   
12. 编辑图形线面下某点高程组，/shape/coordinate/elevation/edit,POST
   * 显示点详情时，列出点下的高程组信息
   * 参数：
      * id：线面点id
      * elevations:[{{top-ele:xxx,name:xxx,value:xxx}}, {...}]
   * 返回：
      * OK,编辑成功
      * DATA_NOEXIST: 点不存在
      * DATA_REFUSE：不是自己的线面下的点                
13. 新建图形线面剖面属性,/shape/shape/attribute/create,GET
   * 用户取得线面详情后，前台列出线面支持的剖面类型，选择一个剖面类型进行新建
   * 后台根据type，在线面下添加剖面的所有属性
   * 线面如果没有剖面属性，不能用于显示BIM
   * 参数：
      * id: 线面id
      * type: 剖面类型
      * 返回：
         * OK，返回josn，[{id:xxx,alias:xxx, name:xxx}, {...}]
         * DATA_NOEXIST: 线面不存在
         * DATA_REFUSE：不是自己的线面
14. 删除图形剖面属性, /shape/shape/attribute/remove, POST
   * 已经新建剖面属性的线面，可以选择删除剖面属性，用户再次选择剖面类型
   * 参数：id：线面id
   * 返回：
      * OK，删除成功
      * DATA_NOEXIST: 线面不存在
      * DATA_REFUSE：不是自己的线面      
15. 编辑图形线面剖面属性, /shape/shape/attribute/edit, POST
   * 前台列出所有剖面属性，用户可以更改属性值
   * 参数：
      * id: 线面id
      * attributes: 剖面属性,[{id:xxx, value:xxx}, {...}]
   * 返回：
      * OK，编辑成功   
      * DATA_NOEXIST: 线面或属性不存在
      * DATA_REFUSE：不是自己的线面
16. 获取建筑物类型,/shape/build/type/download,GET
   * 返回所有线面类型，返回json数组
   * 参数：无
   * 返回：OK，[{"buildModel","大口井","dkj","水源建筑物"},{...}]    
17. 建筑物模板下载, /shape/build/template/download,GET
   * 根据选择的建筑物类型下载模板excel，每个sheet是一个类型的模板
   * 参数：
       * types：字符串，线面枚举逗号隔开:"dkj","tj","..."
   * 返回：
       * OK,自动保存未excel    
18. 单建筑物上传,/shape/single/uploadBuild,POST
   * 只上传excel文件的第一个sheet，建筑物类型就是这个sheet的类型
   * 如果点下有建筑物，那么删除这个建筑物，重新建立新的建筑物
   * 但建筑物上传时，不用匹配中心坐标，直接把建筑物挂在点下
   * 参数：
       * shapeCoordinateId:线面上的点id
       * baseLevelType:基准面类型
       * WGS84Type:WGS84坐标格式
       * file：上传的excel文件
   * 返回：
       * OK: 上传成功
       * COOR_FORMAT_ERROR：上传失败:坐标文件或格式错误;
       * COOR_RETURN_PROMPT: 上传过程有问题，返回相应提示信息，前台显示这些问题描述    
19. 多建筑物上传,/shape/multiple/uploadBuild,POST
   * 可上传多个excel，每个excel包含多个sheet
   * sheet中的中心坐标用于匹配线面上的点，如果匹配上，建筑物就挂在这个点下
   * 如果有匹配不上的建筑物，返回COOR_RETURN_PROMPT
   * 参数：
       * shapeId:线面id
       * baseLevelType:基准面类型
       * WGS84Type:WGS84坐标格式
       * fileName:file对象若干个
   * 返回：
       * OK: 上传成功
       * COOR_FORMAT_ERROR：上传失败:坐标文件或格式错误;
       * COOR_RETURN_PROMPT: 上传过程有问题，返回相应提示信息，前台显示这些问题描述
20. 单建筑物下载, /shape/build/single/download,GET
   * 下载点下的建筑物
   * 参数:
       * coordinateId: 点id
   * 返回:
       * OK，下载成功
       * DATA_NOEXIST: 点不存在
       * DATA_REFUSE：不是自己的线面下的点        
21. 多建筑物下载, /shape/build/multiple/download,GET
   * 下载项目下的所有线面
   * 线面每个点有经纬度，高程，还有高程组
   * 每个sheet是一个点类型
   * 参数:
       * projectId:项目id
   * 返回:
       * OK，下载成功
22. 获取建筑物详情，/shape/build/details/{id},GET
   * 用户在工程布置，选择点，再选择建筑物
   * 返回建筑物自身属性，还有buildAttributes
   * 参数：
      * id：建筑物id
   * 返回：
      * OK：返回json
         * {id:xxx,type:xxx, positionCoor:xxx, buildAttributes:[{id:xxx,name:xxx,alias:xxx,value:xxx},{...}]}
      * DATA_NOEXIST: 建筑物不存在
      * DATA_REFUSE：不是自己的建筑物
23. 编辑建筑物，/shape/build/edit, POST
   * 用户取得建筑物详情，前台显示出建筑物自身属性，还有buildAttributes
   * 用户可以修改显示出来的属性，但是不可以添加，删除属性
   * 建筑物类型不可修改   
   * 参数：
      * id: 建筑物id
      * positionCoor: 定位坐标
      * buildAttributes:[{id:xxx,value:xxx},{...}]}
   * 返回：
      * OK，编辑成功
      * DATA_NOEXIST: 建筑物不存在
      * DATA_REFUSE：不是自己的建筑物         
24. 地图上新建建筑物，/shape/map/build/create,POST
   * 地图绘图时，点击点新建建筑物
   * 这样建立的建筑物定位坐标等于点的坐标
   * 这样建立的建筑物属性为空
   * 参数：
      * shapeId: 线面id
      * type: 建筑物类型,英文
      * description:描述
   * 返回：
      * OK,新建成功    
      * DATA_NOEXIST: 线面不存在
      * DATA_REFUSE：不是自己的线面
25. 地图上编辑建筑物, /shape/map/build/edit, POST
   * 地图绘图时，修改建筑物描述
   * 建筑物类型不可修改
   * 参数：
      * id: 建筑物id
      * description: 描述
26. BIM获取建筑物属性信息,/shape/bim/build/{id},GET
   * BIM端获取建筑物属性，只需返回alis和value即可
   * 参数：id:建筑物id
   * 返回：
      * OK：返回json，参考BIM build json
      * DATA_NOEXIST: 建筑物不存在
      * DATA_REFUSE：不是自己的建筑物
27. BIM获取图形线面及其属性信息,/shape/bim/shape/{id},GET
   * BIM端获取线面属性，包括线面剖面属性(shapeAttributes),线面所有点(shapeCoordinates,包含高程组)
   * 参数：
      * id: 线面id
   * 返回：
      * OK，返回json，参考BIM shape json
      * DATA_NOEXIST: 线面不存在
      * DATA_REFUSE：不是自己的线面        
```
BIM build json
{
  "id":1093,
  "name":"3#",
  "type":"消力池",
  "center": "102.3,65.4,0",
  "position": "102.34,65.45,0",
  "designElevation": 1.34,
  "remark": "测试",
  "wr00013": 12.4,
  "wr00014": 1.56,
  "wr00015": 1.1,
  "wr00016": 0.56,
  "ct0001": "混凝土",
  "ct0022": "混凝土"
}
BIM shape json
{
  "id":234,
  "type": "挡墙",
  "childType":"仰斜式挡墙" 
  "remark": "1#",
  "shapeAttribuet":[{id:xxx,alias:xxx,name:xxx,value:xxx},{...}],
  "shapeCoordinate":[{id:xxx,lng:xxx,lon:xxx,elevations:[{ele:xxx,alias:xxx,name:xxx}, {...}]}, {..}]
}
```       


## 二 BIM测试
1. 获取模板 /testBuild/buildTemplateInfo    get
2. 上传建筑物 /testBuild/uploadBuild   (type  childType ) post   
3. 下载建筑物 /testBuild/downloadBuild?type&&childType   get  
4. bim获取建筑物信息 /testBuild/bim/build?type&&childType   get
   * 返回后台已有的属性，增加bim需要的属性
   * 不需要alias
   * 其中propertyType含义是属性分类，比如坐标coordinate，水利要素hydraulics，控制尺寸dimension，
   * 地基应力groundStress, 构件component
   * 后台已有的属性：
      * name：属性名
      * unit：单位
      * type：类型
      * value: 值
   * 新加的属性：
      * fieldName: bim内部参数名
      * objName: bim构件名
      * attributeType: 属性分类
5. /testBuild/build?type&&childType  get     
   * 以上接口type或者chileType不存在，传空字符串
6. 下载模板 /testBuild/downloadBuildModel?types=,,,  get
   * 同一建筑物有childType只传childType，无childType，传type（commonType）     
