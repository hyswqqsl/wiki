# 系统管理基础数据接口

## 一 行政区基础数据添加，RegionController
1. 取得zTree结构json，/region/admin/tree,GET
    * **web使用**
    * **角色：市河长办管理员**  
    * 得到前台显示用的region属性结构json串
    * 参数：
       * code,行政区code
    * 返回：
        * OK，json串
        * DATA_NOEXIST 行政区不存在        
2. 新建节点，/region/admin/node/create,POST
    * **web使用**
    * **角色：市河长办管理员**
    * 如果是顶级节点，如青海省河段，parentId为0      
    * 参数：
        * parentId,父级节点id
        * name,节点名
    * 返回：
        * OK,删除成功,返回新建的节点{id:xx,name:xxx,pId:xxx}
        * DATA_NOEXIST,parengId不存在              
3. 修改节点，/region/admin/node/update,POST
    * **web使用**
    * **角色：市河长办管理员**  
    * 参数：
        * id,节点id
        * name,节点名
        * code,编码
        * remark,备注
    * 返回：
        * OK,删除成功
        * DATA_NOEXIST,id不存在             
4. 删除节点，/region/admin/node/delete/{id},DELETE
    * **web使用**
    * **角色：市河长办管理员**
    * 如果节点不是叶子节点，不能删除
    * 如果下面有河长，河长办，责任单位，不能删除
    * 参数：
        * id,节点id
    * 返回:
        * OK,删除成功
        * DATA_NOEXIST,id不存在
        * FAIL，删除失败，行政区下有数据
5. 取得行政区详情，/region/details/{id},GET
    * 如果节点不是叶子节点，不能删除
    * 如果下面有河长，河长办，责任单位，不能删除
    * 参数：
        * id,行政区id
    * 返回:
        * OK,行政区所有属性,河长列表，河长办，河长办用户列表，责任单位类别
        * DATA_NOEXIST,行政区不存在
        
## 二 河长编辑接口，HzUserController        
1. 新建河长，/hzUser/admin/create,POST
   * **web端使用**
   * **角色：市河长办管理员**
   * code,phone必须唯一
   * 参数：
       * name
       * code，人员编码
       * phone，手机号
       * type，类型
       * remark，备注
       * regionId，行政区id
   * 返回：
       * OK，新建成功
       * DATA_EXIST,code或手机号已使用
2. 编辑河长，/hzUser/admin/update,POST
   * **web端使用**
   * **角色：市河长办管理员**
   * 参数：
       * id 河长id
       * name 姓名
       * code，人员编码
       * phone，手机号
       * type，类型
       * remark，备注
   * 返回：
       * OK，修改成功
       * DATA_NOEXIST，河长不存在
       * DATA_EXIST,code或手机号已使用           
3. 删除河长,/hzUser/admin/delete/{id},DELETE
   * **web端使用**
   * **角色：市河长办管理员**
   * 参数：
       * id
   * 返回：
       * OK，删除成功 
       * DATA_NOEXIST
4. 取得河长列表，/hzUser/admin/lists,GET       
   * **web端使用**
   * **角色：市河长办管理员**
   * 参数：
       * regionId,行政区id
   * 返回：
       * OK，取得成功 
       * DATA_NOEXIST，行政区不存在          
        
```json
region json格式
[
    {id:"1", pId:"0", name:"西宁市", open:"true", type:"top"},
    {id:"2", pId:"1", name:"城东区", open:"true", type:"child"},
    {id:"3", pId:"1", name:"湟中县", open:"true", type:"child"},
    {id:"31", pId:"3", name:"巴燕乡", open:"true", type:"child"},
]
```        
      
三 河长办编辑接口,HzbController
1. 新建河长办,/hzb/admin/create,POST
   * **web端使用**
   * **角色：市河长办管理员**
   * 只有市，县，乡能建立河长办
   * 参数：
       * name 河长办名称
       * regionId，行政区id
   * 返回：
       * OK，新建成功
       * FAIL，不是市县乡行政区，建立失败
2. 编辑河长办,/hzb/admin/update,POST
   * **web端使用**
   * **角色：市河长办管理员**
   * 参数：
       * id
       * name
       * phone，手机号
       * remark，备注
   * 返回：
       * OK，修改成功
       * DATA_NOEXIST
3. 删除河长办,/hzb/admin/delete/{id},DELETE
   * **web端使用**
   * **角色：市河长办管理员**
   * 如果有河长办用户，不能删除河长办
   * 参数：
       * id
   * 返回：
       * OK，删除成功
       * DATA_NOEXIST          
       
四 河长办用户编辑接口,HzbUserController
1. 新建河长办用户，/hzbUser/admin/create,POST
   * **web端使用**
   * **角色：市河长办管理员**
   * code和phone必须唯一
   * 参数：
       * code 人员编码
       * name 名称
       * remark 备注
       * phone 手机号
       * hzbId 河长办id 
   * 返回：
       * OK，新建成功
       * DATA_NOEXIST,河长办不存在
       * DATA_EXIST,code或手机号已使用           
2. 编辑河长办用户，/hzbUser/admin/update,POST
   * **web端使用**
   * **角色：市河长办管理员**
   * code和phone必须唯一
   * 参数：
       * id 河长办用户id
       * code 人员编码
       * name 名称
       * remark 备注
       * phone 联系电话
   * 返回：
       * OK，编辑成功
       * DATA_NOEXIST,河长办用户不存在
       * DATA_EXIST,code或手机号已使用                  
3. 删除河长办用户，/hzbUser/admin/delete/{id},DELETE
   * **web端使用**
   * **角色：市河长办管理员**
   * 参数：
       * id 河长办用户id
   * 返回：
       * OK，删除成功
       * DATA_NOEXIST,河长办用户不存在  
4. 取得河长办用户列表，/hzbUser/admin/lists,GET       
   * **web端使用**
   * **角色：市河长办管理员**
   * 参数：
       * hzbId,河长办id
   * 返回：
       * OK，返回成功
       * DATA_NOEXIST,河长办不存在  
5. 刷新系统缓存，/Admin/cache/update,POST
   * **web端使用**
   * **角色：市河长办管理员**
   * 参数：无
   * 返回：
       * OK，刷新成功
        
五 责任单位编辑接口,OrganizerController
1. 新建责任单位,/organizer/admin/create,POST
   * **web端使用**
   * **角色：市河长办管理员**
   * 只有市，县，乡有责任单位
   * 参数：
    * code 单位编码
    * name 单位名
    * remark 备注
    * regionId 行政区id
   * 返回：
       * OK，新建成功
       * DATA_NOEXIST,行政区不存在
       * FAIL，不是市县乡行政区，新建失败
2. 编辑责任单位,/organizer/admin/update,POST
   * **web端使用**
   * **角色：市河长办管理员**
   * 参数：
    * id 责任单位id
    * code 单位编码
    * name 单位名
    * remark 备注
   * 返回：
       * OK，编辑成功
       * DATA_NOEXIST,责任单位不存在
3. 删除责任单位，/organizer/admin/delete/{id},DELETE
   * **web端使用**
   * **角色：市河长办管理员**
   * 参数：
    * id 责任单位id
   * 返回：
       * OK，删除成功
       * DATA_NOEXIST,责任单位不存在 
4. 取得责任单位列表，/organizer/admin/lists,GET       
   * **web端使用**
   * **角色：市河长办管理员**
   * 参数：
       * regionId,行政区id
   * 返回：
       * OK，取得成功 
       * DATA_NOEXIST，行政区不存在               
       
六 河流编辑接口，RiverController
1. **取得河湖列表,/river/admin/lists,GET**
   * **web端使用**
   * **角色：市河长办管理员**
    * 参数: 无 
    * 返回：
        * OK,返回河流列表
2. 新建河流,/river/admin/create,POST
   * **web端使用**
   * **角色：市河长办管理员**
   * 河流名不能重复
   * 参数：
    * name 河流名
   * 返回：
       * OK，新建成功
       * FAIL，河流名重复
3. 编辑河流,/river/admin/update,POST
   * **web端使用**
   * **角色：市河长办管理员**
   * 河流名不能重复
   * 参数：
    * id 河流id
    * name 河流名
    * level 河流级别 0-一级 1-二级 2-三级 3-四级
    * @ superRiver 上级河流
   * 返回：
       * OK，编辑成功
       * DATA_NOEXIST,河流不存在
4. 删除河流,/river/admin/delete/{id},DELETE
   * **web端使用**
   * **角色：市河长办管理员**
   * 如果删除河流，意味着河流下的河段和河流联系全部失效，要慎重
   * 参数：
    * id 河流id
   * 返回：
       * OK，删除成功
       * DATA_NOEXIST,河流不存在       

七 一河一档编辑接口，RiverArchiveController
1. 新建一河一档，/riverArchive/admin/create,POST
   * **web端使用**
   * **角色：市河长办管理员**
   * 同一个行政区
   * 参数：
     * name: 一河一档名称
     * riverId: 河流id
   * 返回：
       * OK，新建成功
2. 编辑一河一档，/riverArchive/admin/update,POST
   * **web端使用**
   * **角色：市河长办管理员**
   * 参数：
     * id, 一河一档id
     * name， 一河一档名称
     * regionId,行政区id
     * imageUrl，封面图片
     * content,河湖概况内容
     * @ area,总流域面积
     * @ areaOfRegion,境内流域面积
     * @ upArea,境内及以上流域面积
     * @ length,总河(沟)道长度km）
     * @ lengthOfRegion,境内河(沟)道长度km）
     * @ slope,河(沟)道坡度％
     * @ slopeOfRegion,境内河(沟)道坡度％
     * @ averTimeFlow,多年平均时间流量(m³/s)
     * @ averFlow,多年平均径流量(万m³)
   * 返回：
     * OK，编辑成功
     * DATA_NOEXIST,一河一档不存在
3. 删除一河一档，/riverArchive/admin/delete/{id},DELETE
   * **web端使用**
   * **角色：市河长办管理员**
   * 参数：
     * id, 一河一档id
   * 返回：
     * OK，删除成功
     * DATA_NOEXIST,一河一档不存在
4. 取得一河一档列表,/riverArchive/admin/lists,GET
   * **web端使用**
   * **角色：市河长办管理员**
   * 参数：
     * riverId, 河流id
   * 返回：
     * OK，一河一档列表
     * DATA_NOEXIST,河流不存在     
5. 上传河湖图片，/riverArchive/image/create POST
       * **web端使用**
       * **角色：河长办管理员**    
       * 前台编辑器上传图片时调用后台接口，把图片上传到阿里云的qqslimage/hzy/{regionCode}/riverArchive/中，上传时使用 https://www.cnblogs.com/jdonson/archive/2009/07/22/1528466.html 方式生成图片的唯一编码
       * 上传时对图片进行压缩，以便用户能快速浏览，参见https://blog.csdn.net/niuch1029291561/article/details/17377903 ,压缩到图片宽度600px
       * 参数： 
       * 使用HttpServletRequest request，转换为MultipartHttpServletRequest multiRequest = (MultipartHttpServletRequest) request，取得图片，参见https://blog.csdn.net/qq_24419601/article/details/79784773
       * 返回:
           * OK,数据：{"fileName":"文件名.文件格式","url":"上传成功后得资源路径url"} ,资源路径url是阿里云的路径
           * FAIL                   

八 兴趣点编辑接口,InterestController
1. 新建兴趣点，/interest/admin/create,POST
   * **web端使用**
   * **角色：市河长办管理员**
   * 参数：
     * name, 兴趣点名称
     * archiveId，一河一档id
     * type, 类型，0-公示牌 1-灌区 2-水库 3-污水处理厂 4-排污口 5-水源
     * coor,坐标，必须符合 {经度,纬度,高程}的格式
     * address,地址
     * description,描述
   * 返回：
       * OK，新建成功
2. 编辑兴趣点,/interest/admin/update,POST
   * **web端使用**
   * **角色：市河长办管理员**
   * 参数：
     * id, 兴趣点id
     * name, 兴趣点名称
     * type, 类型，0-公示牌 1-灌区 2-水库 3-污水处理厂 4-排污口 5-水源
     * coor,坐标，必须符合 {经度,纬度,高程}的格式
     * address,地址
     * description,描述
   * 返回：
       * OK，编辑成功
       * DATA_NOEXIST，兴趣点不存在
3. 删除兴趣点,/interest/admin/delete/{id},DELETE
   * **web端使用**
   * **角色：市河长办管理员**
   * 删除兴趣点会把相关的巡河记录删除，要慎重
   * 参数：
     * id, 兴趣点id
   * 返回：
       * OK，删除成功
       * DATA_NOEXIST，兴趣点不存在       
4. 取得兴趣点列表，/interest/admin/lists,GET       
   * **web端使用**
   * **角色：市河长办管理员**
   * 参数：
       * archiveId,一河一档id
   * 返回：
       * OK，取得成功
       * DATA_NOEXIST，一河一档不存在  

九 河段编辑接口,RiverSegmentController      
1. 取得zTree结构json，/riverSegment/admin/tree,GET
    * **web使用**
    * **角色：市河长办管理员**  
    * 得到前台显示用的riverSegent属性结构json串
    * 参数：
       * riverId,河流id
    * 返回：
        * OK，json串 
        * DATA_NOEXIST 河流不存在
2. 新建河段，/riverSegment/admin/create,POST
   * **web端使用**
   * **角色：市河长办管理员**
   * 如果是顶级节点，如西宁市河段，parentId为0
   * 参数：
       * name, 河段名称
       * parentID，父级节点id
       * riverId，河流id
   * 返回：
       * OK，新建成功
3. 编辑河段，/riverSegment/admin/update,POST
   * **web端使用**
   * **角色：市河长办管理员**
   * 如果是顶级节点，如西宁市河段，parentId为0
   * 参数：
       * id,河段id
       * name, 河段名称
       * length,河段长度
       * beginStation,开始位置
       * endStation,结束位置
       * regionId,行政区id
       * hzUserId,责任河长id
   * 返回：
       * OK，编辑成功
       * DATA_NOEXIST,河段，行政区或责任河长不存在       
4. 取得所属行政区，/riverSegment/admin/region/lists,GET
   * **web端使用**
   * **角色：市河长办管理员**
   * 顶级节点的parentId=0;根据上级节点取不到上级行政区，返回所有市级，县级行政区
   * 如果取到上级行政区，返回上级行政区下一级行政区，如上级是西宁市，返回西宁市县级行政区 
   * 参数：
       * parentId 上级节点id
   * 返回：
       * OK，行政区list
5. 取得行政区下的河长列表，/riverSegment/admin/hzUser/lists,GET
   * **web端使用**
   * **角色：市河长办管理员**
   * 参数：
       * regionId,行政区id
   * 返回：
       * OK，行政区下的河长list
       * DATA_NOEXIST，行政区不存在
6. 删除河段，/riverSegment/admin/delete/{id},DELETE
   * **web端使用**
   * **角色：市河长办管理员**
   * 如果不是叶子节点，不能删除
   * 如果河段下有巡河，不能删除
   * 参数：
       * id,河段id
   * 返回：
       * OK，删除成功
       * DATA_NOEXIST，河段不存在
       * FAIL，删除失败，河段下有数据
7. 上传河段坐标,/riverSegment/admin/uploadCoor,POST
   * **web端使用**
   * **角色：市河长办管理员**
   * 如果不是叶子节点，不能删除
   * 参数：
       * id,河段id
       * file,上传的excel文件
       * type，0-线坐标，1-面坐标
   * 返回：
       * OK，删除成功，返回河段coors,{coors:[{lon:xx,lat:xx,ele:xx},{...}],type:"线坐标"}
       * DATA_NOEXIST，河段不存在
       * FAIL,文件格式错误       
       
       
```json
riverSegment json格式
[
    {id:"1", pId:"0", name:"西宁市段", open:"true", type:"top"},
    {id:"2", pId:"1", name:"城东区段", open:"true", type:"child"},
    {id:"3", pId:"1", name:"湟中县段", open:"true", type:"child"},
    {id:"31", pId:"3", name:"巴燕乡段", open:"true", type:"child"},
]
```      