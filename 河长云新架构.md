<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
**Table of Contents**  *generated with [DocToc](https://github.com/thlorenz/doctoc)*

- [河长云新架构接口](#%E6%B2%B3%E9%95%BF%E4%BA%91%E6%96%B0%E6%9E%B6%E6%9E%84%E6%8E%A5%E5%8F%A3)
  - [河长云类结构](#%E6%B2%B3%E9%95%BF%E4%BA%91%E7%B1%BB%E7%BB%93%E6%9E%84)
  - [一 系统管理员，SystemAdminController](#%E4%B8%80-%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E5%91%98systemadmincontroller)
  - [二 平台，PlatformController](#%E4%BA%8C-%E5%B9%B3%E5%8F%B0platformcontroller)
  - [三 河流，RiverController](#%E4%B8%89-%E6%B2%B3%E6%B5%81rivercontroller)
  - [四 水资源，WaterResourceController](#%E5%9B%9B-%E6%B0%B4%E8%B5%84%E6%BA%90waterresourcecontroller)
  - [五 扩展项, ExtraController](#%E4%BA%94-%E6%89%A9%E5%B1%95%E9%A1%B9-extracontroller)
  - [六 行政区, RegionController](#%E5%85%AD-%E8%A1%8C%E6%94%BF%E5%8C%BA-regioncontroller)
  - [七 河湖段，segmentController](#%E4%B8%83-%E6%B2%B3%E6%B9%96%E6%AE%B5segmentcontroller)
  - [八. 成员单位，UnitController](#%E5%85%AB-%E6%88%90%E5%91%98%E5%8D%95%E4%BD%8Dunitcontroller)
  - [九 公众号菜单接口,WeChatController,GET](#%E4%B9%9D-%E5%85%AC%E4%BC%97%E5%8F%B7%E8%8F%9C%E5%8D%95%E6%8E%A5%E5%8F%A3wechatcontrollerget)
  - [十 河长 HzUserController](#%E5%8D%81-%E6%B2%B3%E9%95%BF-hzusercontroller)
  - [十一 ComplaintControler，投诉](#%E5%8D%81%E4%B8%80-complaintcontroler%E6%8A%95%E8%AF%89)
  - [十二 ArchiveController,一河一档控制层](#%E5%8D%81%E4%BA%8C-archivecontroller%E4%B8%80%E6%B2%B3%E4%B8%80%E6%A1%A3%E6%8E%A7%E5%88%B6%E5%B1%82)
  - [十三  ArticleController 新闻动态和政策方案](#%E5%8D%81%E4%B8%89--articlecontroller-%E6%96%B0%E9%97%BB%E5%8A%A8%E6%80%81%E5%92%8C%E6%94%BF%E7%AD%96%E6%96%B9%E6%A1%88)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

# 河长云新架构接口

## 河长云类结构
![新架构123](/uploads/94f04649ef22dcf0d5f721d6327fceb8/新架构123.jpg)

## 一 系统管理员，SystemAdminController 
1. 登录发送验证码: /systemAdmin/login/getLoginVerify,GET
   * **角色：无**
   * 系统管理员登录时，取得验证码
   * 参数：
      * phone:登录手机号
   * 返回：
      * OK:发送成功
      * DATA_NOEXIST:账号不存在
2. 登录：/systemAdmin/login,POST
   * **角色：无**
   * 每次登录都是用动态验证码
   * 参数：
      * verification:验证码
   * 返回:
      * OK:成功成功
      * 4041: CODE_INVALID 验证码过期
      * 4042: CODE_ERROR 验证码输入错误
3. 取得系统管理员，/systemAdmin/getUser,GET
   * **角色：无**
   * 参数：
   * 返回：
      * OK(系统管理员对象)，包含系统员属性和角色
      * 4011: NO_SESSION,未登录
4. 系统管理员注销,/systemAdmin/logout POST
   * **角色：系统管理员**
   * 参数：无
   * 返回：OK,注销成功
                

## 二 平台，PlatformController
1. 新建平台，/platform/systemAdmin/create, POST
   * **角色：系统管理员**
   * 参数:
     * name: 平台名称
     * regionCode：对应的行政区编码
     * type: 平台类型，FULL_PLATFORM：完整，WECHAT_PLATFORM： 微信公众号
     * appId: 微信appId
     * appSecret: 微信appSecret
   * 返回:
     * OK，新建成功
     * DATA_EXIST: 对应的行政区已有平台，或appId已使用
2. 取得平台列表, /platform/systemAdmin/list, GET
   * **角色：系统管理员**
   * 参数: 无
   * 返回：
     * OK，返回数组，每项包含平台中所有属性
3. 编辑平台, /platform/systemAdmin/edit, POST
   * **角色：系统管理员**
   * 参数:
     * id: 平台id
     * name: 平台名称
     * regionCode：对应的行政区编码
     * type: 平台类型，FULL_PLATFORM：完整，WECHAT_PLATFORM： 微信公众号
     * appId: 微信appId
     * appSecret: 微信appSecret
   * 返回:
     * OK，编辑成功
     * DATA_NOEXIST: 平台不存在
     * DATA_EXIST: 对应的行政区已有平台，或appId已使用
     * DATA_LOCK: 平台下已有行政区结构，不能修改行政区编码
4. 删除平台, /platform/systemAdmin/delete{id}，DELETE
   * **角色：系统管理员**
   * 平台下如果有河流，水资源，行政区，公众号号菜单，新闻菜单，新闻动态，通报，不能删除
   * 参数: id
   * 返回:
	 * OK，删除成功
	 * DATA_NOEXIST,平台不存在
	 * DATA_LOCK, 平台下有数据，不能删除

## 三 河流，RiverController
1. 新建河流节点，/river/systemAdmin/node/create,POST
   * **角色：系统管理员**
   * 如果是顶级节点，如西宁平台的湟水河，pId为0
   * level 河流级别,根据上级河流节点自动确定 0-一级 1-二级 2-三级 3-四级
   * 参数：
     * platformId，平台id
     * pId,父级节点id
     * name,节点名
   * 返回：
      * OK: 新建成功,返回新建的节点{id:xx,name:xxx,pId:xxx}
      * DATA_NOEXIST: 平台或父节点不存在
2. 取得ZTree河湖json,/river/systemAdmin/tree,GET
   * **角色：系统管理员**
   * 参数: 
      * platformId: 平台id 
   * 返回：
      * OK,返回河流zTree使用的json 
3. 编辑河流节点，/river/systemAdmin/node/update,POST
   * **角色：系统管理员**
   * 参数：
     * id,节点id
     * name,节点名
     * code,编码
     * level: 河流级别
     * remark,备注
   * 返回：
     * OK: 编辑成功
     * DATA_NOEXIST: id不存在 
     * DATA_LOCK: 有子节点，不能编辑河流级别
4. 上传河流线坐标,/river/systemAdmin/upload/lineCoors,POST
   * **角色：系统管理员**
   * excel包含一个线坐标
   * 参数：
       * id,河流id
       * file,上传的excel文件
   * 返回：
       * OK，上传成功，返回河流所有属性
       * DATA_NOEXIST，河段不存在
       * FAIL,文件格式错误
5. 下载河流线坐标,/river/systemAdmin/download/lineCoors,GET
   * **角色：系统管理员**
   * 参数：
       * id,河流id
   * 返回：
       * OK，下载成功，返回excel流，浏览器保存为excel文件
       * DATA_NOEXIST，河流不存在
       * FAIL,文件格式错误     
6. 上传流域面坐标，/river/systemAdmin/upload/areaCoors,POST
   * **角色：系统管理员**
   * excel包含一个流域面坐标
   * 参数：
       * id,河流id
       * file,上传的excel文件
   * 返回：
       * OK，上传成功，返回河流所有属性
       * DATA_NOEXIST，河段不存在
       * FAIL,文件格式错误 
7. 下载河流面坐标,/river/systemAdmin/download/areaCoors,GET
   * **角色：系统管理员**
   * 参数：
       * id,河流id
   * 返回：
       * OK，下载成功，返回excel流，浏览器保存为excel文件
       * DATA_NOEXIST，河流不存在
       * FAIL,文件格式错误
8. 上传河流左右岸线坐标,/river/systemAdmin/upload/leftRightCoors,POST
   * **角色：系统管理员**
   * excel包含两个线坐标，sheet名字左岸，右岸
   * 参数：
       * id,河流id
       * file,上传的excel文件
   * 返回：
       * OK，上传成功，返回河流所有属性
       * DATA_NOEXIST，河段不存在
       * FAIL,文件格式错误
9. 下载河流左右岸坐标,/river/systemAdmin/download/leftRightCoors,GET
   * **角色：系统管理员**
   * 参数：
       * id,河流id
   * 返回：
       * OK，下载成功，返回excel流，浏览器保存为excel文件
       * DATA_NOEXIST，河流不存在
       * FAIL,文件格式错误                
10. 取得平台下所有河流线坐标,/river/lineCoors/lists,GET
   * **角色：无**
   * 增加 archiveId 一河一档id
   * 参数：
       * platformId,平台id
   * 返回：
       * OK，返回json列表，[{id:xxx,name:xxx,archiveId:xxx,lineCoors:[]},{...}]
       * DATA_NOEXIST，平台不存在
       * FAIL,文件格式错误    
11. 删除河流节点，/river/systemAdmin/node/delete/{id},DELETE
   * **角色：系统管理员**
   * 如果节点不是叶子节点，不能删除
   * 如果水资源下有有河湖段划分，河湖档案下有扩展项，不能删除
   * 删除时，要把河湖档案，河湖档案下的的属性删除
   * 参数：
     * id,节点id
   * 返回:
     * OK,删除成功
     * DATA_NOEXIST,id不存在
     * FAIL，删除失败，河流下有数据
12. 取得河流详情: /river/systemAdmin/details/{id}, GET
   * **角色：系统管理员**
   * 参数： id：河流id
   * 返回：
     * OK，返回河流所有屬性，及所有坐标
     * DATA_NOEXIST,河流不存在
6. 河长办得zTree相关河流json,/river/tree,GET
   * **角色：河长办人员**
   * 河长办人员登陆后,要把平台id存在session中,取得河流zTree时,使用平台id 
   * 角色：市，县河长办管理员
   * 参数: 无
   * 返回：
     * OK,返回zTree河流json
8. 编辑河湖档案，/river/systemAdmin/archive/edit, POST	 
   * **角色：系统管理员**
   * 参数： 
     * id：河流id
     * name，档案名称
     * imageUrl，封面图片
     * content,河湖概况内容
   * 返回：
	 * OK
     * DATA_NOEXIST,河流不存在
	 * DATA_REFUSE, 不是本平台的河流，不能编辑档案	 	 
10. 编辑河湖档案属性,/river/systemAdmin/archive/attribute/edit
   * **角色：系统管理员**
   * 参数： 
	 * id：河流id
	 * attributes: [{alias:xxx, value:xxx}, {...}]
   * 返回：
	 * OK，保存成功
     * DATA_NOEXIST,河流不存在
12. 更新河流下的河段坐标，/river/systemAdmin/segment/coors/update,POST
   * **角色：系统管理员**
   * 根据河段下的起始坐标和结束坐标，分析每个河段的线坐标，保存河段坐标
   * 参数： 	
   	 * id：河流id
   * 返回：
	 * OK，更新成功
     * DATA_NOEXIST,河流不存在	
13. 上传河流图片，/river/systemAdmin/archive/image/create POST
       * **web端使用**
       * **角色：系统管理员**    
       * 前台编辑器上传图片时调用后台接口，把图片上传到阿里云的qqslimage/hzy/{regionCode}/archive/中，上传时使用 https://www.cnblogs.com/jdonson/archive/2009/07/22/1528466.html 方式生成图片的唯一编码
       * 上传时对图片进行压缩，以便用户能快速浏览，参见https://blog.csdn.net/niuch1029291561/article/details/17377903 ,压缩到图片宽度600px
       * 参数： 
       * 使用HttpServletRequest request，转换为MultipartHttpServletRequest multiRequest = (MultipartHttpServletRequest) request，取得图片，参见https://blog.csdn.net/qq_24419601/article/details/79784773
       * 返回:
           * OK,数据：{"fileName":"文件名.文件格式","url":"上传成功后得资源路径url"} ,资源路径url是阿里云的路径
           * FAIL       
	 
## 四 水资源，WaterResourceController
1. 新建水资源, /waterResource/systemAdmin/create, POST
   * **角色：系统管理员**
   * 参数：
     * platformId：平台id
     * name,节点名
     * type: 湖泊，LAKE，水库，RESERVOIR，水源地，WATER_PLACE，灌区，IRRIGATION_AREA
     * remark,备注
   * 返回：
     * OK: 新建成功
     * DATA_NOEXIST: 平台不存在
2. 取得水资源列表, /waterResource/systemAdmin/list, GET
   * **角色：系统管理员**
   * 参数：
     * platformId: 平台id
   * 返回:
     * OK, 返回水资源数组，每项包含所有属性
3. 编辑水资源， /waterResource/systemAdmin/edit, POST
   * **角色：系统管理员**
   * 参数：
     * id: 水资源id
	 * name, 节点名
	 * type: 湖泊，LAKE，水库，RESERVOIR，水源地，WATER_PLACE，灌区，IRRIGATION_AREA
	 * remark: 备注
	 * riverId: 河流id
   * 返回：
	 * OK： 编辑成功
	 * DATA_NOEXIST: 水资源或河流不存在
	 * DATA_LOCK: 已建立河湖概况，不能编辑类型
4. 上传水资源坐标,/waterResource/systemAdmin/upload/coors,POST
   * **角色：系统管理员**
   * excel包含一个面坐标
   * 参数：
       * id,水资源id
       * file,上传的excel文件
   * 返回：
       * OK，上传成功，返回水资源所有属性
       * DATA_NOEXIST，河段不存在
       * FAIL,文件格式错误
4. 下载水资源坐标,/waterResource/systemAdmin/download/coors,GET
   * **角色：系统管理员**
   * 参数：
       * id,水资源id
   * 返回：
       * OK，下载成功，返回excel流，浏览器保存为excel文件
       * DATA_NOEXIST，水资源不存在
       * FAIL,文件格式错误
4. 取得所有水资源点坐标，/waterResource/systemAdmin/coor/lists,GET
   * **角色：无**
   * 参数：
       * platformId,平台id
   * 返回：
       * OK，返回json列表，[{id:xxx,name:xxx,coor:{...}},{...}]
       * DATA_NOEXIST，平台不存在
       * FAIL,文件格式错误            
4. 删除水资源,/waterResource/systemAdmin/delete/{id}, DELETE
   * **角色：系统管理员**
   * 如果水资源下有有河湖段划分，河湖档案下有扩展项，不能删除
   * 删除时，要把河湖档案，河湖档案下的的属性删除
   * 参数：id
   * 返回：
	 * OK，删除成功
	 * DATA_NOEXIST: 水资源不存在
	 * DATA_LOCK: 水资源下有数据,不能删除
5. 取得水资源详情, /waterResource/systemAdmin/details/{id}, GET
   * 角色：系统管理员
   * 参数：id, 水资源id
   * 返回：
	 * OK，返回水资源所有属性
	 * DATA_NOEXIST, 水资源不存在
6. 河长办取得水资源列表, /waterResource/list, GET
   * 角色：河长办人员
   * 河长办人员登陆后,要把平台id存在session中,取得河流zTree时,使用平台id
   * 增加一河一档id，archiveId
   * 参数: 无
   * 返回:
	 * OK, 返回水资源列表
8. 编辑水资源档案，/waterResource/systemAdmin/archive/edit, POST	 
   * **角色：系统管理员**
   * 参数： 
     * id：河流id
     * name，档案名称
     * imageUrl，封面图片
     * content,河湖概况内容
   * 返回：
	 * OK
     * DATA_NOEXIST,河流不存在
	 * DATA_REFUSE, 不是本平台的河流，不能编辑档案	 	 
10. 编辑水资源档案属性,/waterResource/systemAdmin/archive/attribute/edit
   * **角色：系统管理员**
   * 参数： 
	 * id：河流id
	 * attributes: [{alias:xxx, value:xxx}, {...}]
   * 返回：
	 * OK，保存成功
     * DATA_NOEXIST,河流不存在	 
11. 上传水资源图片，/waterResource/systemAdmin/archive/image/create POST
       * **web端使用**
       * **角色：系统管理员**    
       * 前台编辑器上传图片时调用后台接口，把图片上传到阿里云的qqslimage/hzy/{regionCode}/archive/中，上传时使用 https://www.cnblogs.com/jdonson/archive/2009/07/22/1528466.html 方式生成图片的唯一编码
       * 上传时对图片进行压缩，以便用户能快速浏览，参见https://blog.csdn.net/niuch1029291561/article/details/17377903 ,压缩到图片宽度600px
       * 参数： 
       * 使用HttpServletRequest request，转换为MultipartHttpServletRequest multiRequest = (MultipartHttpServletRequest) request，取得图片，参见https://blog.csdn.net/qq_24419601/article/details/79784773
       * 返回:
           * OK,数据：{"fileName":"文件名.文件格式","url":"上传成功后得资源路径url"} ,资源路径url是阿里云的路径
           * FAIL 	 
	 
## 五 扩展项, ExtraController
1. 取得扩展项分类,/extra/type/download,GET
   * **角色：所有登录的有session的角色**
   * 参数：
	 * 无
   * 返回：   
	 * OK,json:[{type:"line",childType:xxx, name:xxx},{...}]    
1. 取得扩展项列表,/extra/list
   * **角色：所有登录的有session的角色**
   * 参数：
	 * archiveId，河湖档案id
   * 返回：
	 * OK，扩展项列表，[{id，name，type，childType,coors},{...}]
	 * DATA_NOEXIST,河湖档案不存在
1. 取得扩展项详情,/extra/details/{id},GET
   * **角色：所有登录的有session的角色**
   * 参数：
	 * id，扩展项id
   * 返回：
	 * OK，扩展项所有属性,包含下面的属性,根据xml配置的结构返回json
	 * DATA_NOEXIST,扩展项不存在   
1. 新建扩展项,/extra/systemAdmin/create,POST
   * **角色：系统管理员**
   * 参数：
	 * archiveId，河湖档案id
	 * name，名称
	 * type, point-点，line-线，area-面
	 * childType, 每个分类的childType见 扩展项类型
   * 返回：
	 * OK,新建成功，返回扩展项所有属性
	 * DATA_NOEXIST,河湖档案不存在
	 * FAIL,类型错误
2. 编辑扩展项,/extra/systemAdmin/edit, POST
   * **角色：系统管理员**
   * 如果是点类型扩展项，编辑时，必须传递坐标点
   * 如果是线面类型扩展项，编辑时，坐标点不传
   * 参数：
	 * id，扩展项id
	 * name，名称
	 * type, point-点，line-线，area-面
	 * childType, 每个分类的childType见 扩展项类型
	 * @ coors: 坐标
   * 返回：
	 * OK,新建成功，返回扩展项所有属性
	 * DATA_NOEXIST,扩展项不存在
	 * DATA_LOCK,如果扩展项下有属性，不能修改类型
	 * FAIL,类型错误
3. 上传扩展项坐标，/extra/systemAdmin/upload/coors,POST
   * **角色：系统管理员**
   * excel包含一个线面坐标
   * 参数：
       * id,扩展项id
       * file,上传的excel文件
   * 返回：
       * OK，上传成功，返回扩展项所有属性
       * DATA_NOEXIST，扩展项不存在
       * FAIL,文件格式错误
4. 下载扩展项坐标, /extra/systemAdmin/download/coors,GET
   * **角色：系统管理员**
   * 参数：
       * id,扩展项id
   * 返回：
       * OK，下载成功，返回excel流，浏览器保存为excel文件
       * DATA_NOEXIST，扩展项不存在
       * FAIL,文件格式错误
5. 删除扩展项,/extra/systemAdmin/delete, POST
   * **角色：系统管理员**   
   * 删除时，要把扩展项下的的属性删除   
   * 参数：
       * id,扩展项id
   * 返回：
       * OK，删除成功
       * DATA_NOEXIST，扩展项不存在
7. 编辑扩展项属性,/extra/systemAdmin/attribute/edit
   * **角色：系统管理员**
   * 参数： 
	 * id：扩展项id
	 * attributes: [{alias:xxx, value:xxx}, {...}]
   * 返回：
	 * OK，保存成功
     * DATA_NOEXIST,扩展项不存在
	   
## 六 行政区, RegionController
1. 新建行政区节点，/region/systemAdmin/node/create,POST
   * **角色：系统管理员**
   * 如果是顶级节点，如西宁平台的西宁市节点，pId为0
   * 如果不是父节点，name新建的节点级别默认是父节点的下一级
   * 参数：
	 * platformId, 平台id 
	 * pId,父级节点id
	 * name,节点名
   * 返回：
	 * OK,新建成功,返回新建的节点{id:xx,name:xxx,pId:xxx}
	 * DATA_NOEXIST: 平台或父节点不存在
2. 系统管理员取得行政区zTree结构json，/region/systemAdmin/tree,GET
   * **角色：系统管理员**
   * 得到前台显示用的region属性结构json串
   * 参数：
	 * platformId: 平台id
   * 返回：
	 * OK，zTree的json串
	 * DATA_NOEXIST 平台不存在 		
3. 系统管理员修改行政区节点，/region/systemAdmin/node/update,POST
   * **角色：系统管理员**
   * 参数：
	 * id,节点id
	 * name,节点名
	 * code,编码
	 * level,级别 PROVINCE("省级"), CITY("市州级"), COUNTY("县级"), TOWN("乡镇级"), VILLAGE("村级")
	 * remark,备注
   * 返回：
	 * OK,修改成功
	 * DATA_NOEXIST,id不存在
	 * DATA_LOCK, 有子节点，不能编辑级别
	 * DATA_REFUSE, 级别高于父节点，级别设置错误
4. 系统管理员删除行政区节点，/region/systemAdmin/node/delete/{id},DELETE
   * **角色：系统管理员**
   * 如果节点不是叶子节点，不能删除
   * 如果下面有河长，责任单位，不能删除
   * 参数：
	 * id,节点id
   * 返回:
	 * OK,删除成功
	 * DATA_NOEXIST,id不存在
	 * DATA_LOCK，删除失败，行政区下有数据
5. 系统管理员取得行政区详情，/region/systemAdmin/details/{id},GET
   * **角色：系统管理员**
   * 参数：
	 * id,行政区id
   * 返回:
	 * OK,行政区所有属性,行政区所有属性，新闻菜单列表，公众号菜单列表
	 * DATA_NOEXIST,行政区不存在
6. 河长办得zTree结构json，/region/tree,GET
   * 角色：河长办人员
   * 得到前台显示用的region属性结构json串
   * 河长办人员登陆后,要把平台id存在session中,取得行政区zTree时,使用平台id
   * 参数：无
   * 返回：
	 * OK，zTree的json串
7. 河长办管理员取得行政区详情，/region/details/{id},GET
   * 角色：河长办人员
   * 参数：
	 * id,行政区id
   * 返回:
	 * OK,行政区所有属性,河长列表，河长办，河长办用户列表，责任单位类别
	 * DATA_NOEXIST,行政区不存在
	 * DATA_REFUSE,不是本平台的政区，不能查看
      
## 七 河湖段，segmentController
1. 取得河段zTree结构json，/segment/systemAdmin/river/tree,GET
    * **角色：所有登录系统的人员，只要有session**
    * 得到前台显示用的segment属性结构json串
    * 包含河段属性+所属行政区列表+每个行政区下河长列表
    * 如果是顶级节点，所属行政区列表时所有市州级行政区，如果不是顶级节点，所属行政区是上级行政区的下级行政区列表
    * 参数：
       * riverId,河流id
    * 返回：
        * OK，JSON
        * DATA_NOEXIST 河流不存在
2. 取得水资源段zTree结构json, /segment/systemAdmin/waterResource/tree,GET
    * **角色：所有登录系统的人员，只要有session**
    * 得到前台显示用的segment属性结构json串
    * 包含水资源段属性+所属行政区列表+每个行政区下河长列表
    * 如果是顶级节点，所属行政区列表时所有市州级行政区，如果不是顶级节点，所属行政区是上级行政区的下级行政区列表
    * 参数：
       * waterResourceId,水资源id
    * 返回：
        * OK，JSON
        * DATA_NOEXIST 河流不存在
3. 新建根节点河段，/segment/systemAdmin/river/root/create,POST
   * **角色：系统管理员**
   * pId一定要是0，否则不能新建，返回FAIL
   * 参数：
       * name, 河段名称
       * pId，父级节点id
       * riverId，河流id
       * level 1-市级 2-县级 3-乡级 4-村级
   * 返回：
       * OK，新建成功
4. 新建子节点河段，/segment/systemAdmin/river/create,POST
   * **角色：系统管理员**
   * 判断上级节点是否有行政区，如果没有，不能保存，返回DATA_LOCK
   * 参数：
       * name, 河段名称
       * pId，父级节点id
       * riverId，河流id
   * 返回：
       * OK，新建成功
       * DATA_LOCK 上级节点没有行政区
9. 新建根节点水资源段，/segment/systemAdmin/waterResource/root/create,POST
   * **角色：系统管理员**
   * pId一定要是0，否则不能新建，返回FAIL
   * 参数：
       * name, 水资源段名称
       * pId，父级节点id
       * waterResourceId，水资源id
       * level 1-市级 2-县级 3-乡级 4-村级
   * 返回：
       * OK，新建成功
10. 新建子节点水资源段，/segment/systemAdmin/waterResource/create,POST
   * **角色：系统管理员**
   * 判断上级节点是否有行政区，如果没有，不能保存，返回DATA_LOCK
   * 参数：
       * name, 河段名称
       * pId，父级节点id
       * waterResourceId，水资源id
   * 返回：
       * OK，新建成功
       * DATA_LOCK 上级节点没有行政区
11. 编辑河段，/segment/systemAdmin/update,POST
   * **角色：系统管理员**
   * 编辑河段，水资源段通用
   * 如果是顶级节点，如西宁市河段，pId为0
   * 如果传入的河段行政区id和自己的行政区id不一致，判断是否是叶子节点，可以保存，否则返回DATA_LOCK
   * 如果传入的河段行政区id和自己的行政区id不一致，判断水资源段下是否有河长，如果有河长，返回DATA_LOCK   
   * 参数：
       * id,河段id
       * name, 水资源名称
       * length,水资源长度
       * beginStation,开始位置
       * endStation,结束位置
	   * beginCoor, 开始坐标
	   * endCoor, 结束坐标
       * regionId,行政区id
   * 返回：
       * OK，编辑成功
       * DATA_NOEXIST,水资源，行政区长不存在       
       * DATA_LOCK,河段有下级数据，行政区不能修改
12. 删除河段，/segment/systemAdmin/delete/{id},DELETE
   * **角色：系统管理员**
   * 删除河段，水资源段通用
   * 如果不是叶子节点，不能删除
   * 如果河段下有巡河，不能删除
   * 参数：
       * id,河段id
   * 返回：
       * OK，删除成功
       * DATA_NOEXIST，水资源不存在
       * FAIL，删除失败，水资源下有数据

## 八. 成员单位，UnitController
1. 新建成员单位,/unit/systemAdmin/create,POST
   * **角色：系统管理员**
   * 成员单位分为三种类型：HZB(河长办),HYDROL(水利部门),OTHER(其他)
   * 成员单位下有坐标，标识单位所在地，成员单位下有用户，登录后可以执行相关操作
   * 河长办可以处理日常工作，登记事件，查看统计，考核等；水利部门可以填报水质报表
   * 所有成员单位都可以承办事件
   * 一个行政区内只能有一个河长办类型的成员单位
   * 参数
       * name,单位名称
       * remark,备注
       * phone,联系电话(不用判断唯一性)
       * regionId，所属行政区
       * type, HZB(河长办),HYDROL(水利部门),OTHER(其他)
       * coor, 坐标
       * address, 地址
  * 返回:
	* OK，新建成功
	* DATA_EXIST，行政区内已有河长办，不能再新建河长办
2. 编辑成员单位，/unit/systemAdmin/edit,POST
   * **角色：系统管理员**
   * 类型不可编辑，所属行政区不可编辑
   * 参数
	   * id，unitId
       * name,单位名称
       * remark,备注
       * phone,联系电话(不用判断唯一性)
       * coor, 坐标
       * address, 地址
  * 返回:
	* OK，编辑成功
	* DATA_NOEXIST，成员单位不存在
3. 取得成员单位列表,/unit/list,GET
  * **角色：所有拥有session的，登录的用户**
  * 返回的列表，保证河长办在列表最前面
  * 参数
	* regionId, 行政区id
  * 返回
	* OK, 行政区下所有成员单位列表,保证河长办在列表最前面
4. 删除成员单位,/unit/systemAdmin/delete/{id}, DELETE
   * **角色：系统管理员**
   * 如果成员单位下有用户，不能删除
  * 参数
	* id, unitId
  * 返回
	* OK，删除成功
	* DATA_NOEXIST，成员单位不存在

## 九 公众号菜单接口,WeChatController,GET
1. 根据code取得unionId,/weChat/unionId,GET
  * **weChat使用**
  * **角色：无**
  * 取得unionId成功后，将unionId存在session中，直接登录
  * 参数：
    * code，微信code
    * platformId:平台id
  * 返回：
    * OK，{unionId:xxx, name:xxx, qqslBucket:xxx, qqslimageBucket:xxx,level:xxx,weChatMenus:[{enum:0, title:新闻动态},{}], articleMenus:[{enum:0, title:新闻动态},{...}]}
2. 移动端微信用户登录,/weChat/login,POST
   * **app端使用**
   * **角色：无** 
   * 微信登录，把unionId存入session中
   * 参数：
	 * unionId：微信unionId
     * platformId:平台id
   * 返回
     * OK，登录成功  {qqslBucket:xxx, qqslimageBucket:xxx, level:xxx, weChatMenus:[{enum:0, title:新闻动态},{}], articleMenus:[{enum:0, title:新闻动态},{...}}
3. 取得定义的公众号新闻菜单列表,/weChat/articleMenu/define/lists
   * web端
   * 角色：无
   * 返回当前定义的菜单项列表，包含枚举值，中文标题名,是否显示图片[{id:xxx, menu:0, title:州级台账, imageStatus:0},{...}]    
   * 参数：
     * platformId,平台id
   * 返回：
     * OK, 行政区(公众号)下设置的菜单列表,如果没有设置，返回空数组
4. 新建公众号新闻菜单,/weChat/systemAdmin/articleMenu/web/create,POST
   * web端
   * 角色，系统管理员
   * 新建的菜单中的menu必须是没有使用过的，如果使用过返回DATA_EXIST
   * 参数：
     * platformId,平台id
     * title:菜单标题，如市级动态，市级台账等 
     * menu:菜单枚举0-3数字
     * imageStatus: 枚舉，0-不显示，1-显示
   * 返回：
     * OK,新建成功
     * DATA_EXIST,对应菜单已经存在，不能重复新建
5. 修改公众号新闻菜单,/weChat/systemAdmin/articleMenu/web/update,POST
  * web端
  * 角色，系统管理员
  * 参数：
     * id:菜单id
     * title:菜单标题，如市级动态，市级台账等
     * imageStatus: 枚舉，0-不显示，1-显示
  * 返回：
     * OK,修改成功
     * DATA_NOEXIST,菜单不存在
6. 删除公众号新闻菜单,/weChat/systemAdmin/articleMenu/web/delete/{id},DELETE
  * web端
  * 角色，系统管理员
  * 如果该menu菜单下有新闻，不能删除
  * 参数：
     * id:菜单id
  * 返回：
     * OK,删除成功
     * DATA_NOEXIST,菜单不存在          
7. 取得系统内新闻菜单项列表, /weChat/systemAdmin/articleMenu/lists ,GET
  * web
  * 角色，系统管理员
  * 返回系统内菜单项列表，包含枚举值，中文默认标题名,[{menu:0, title:菜单0}, ...]  
  * 用于在添加菜单时，显示所有菜单下拉项      
  * 参数：无
  * 返回：
    * Ok,返回菜单项列表
8. 取得定义的公众号菜单列表,/weChat/menu/define/lists
  * weChat使用
  * web端,角色，无
  * 返回当前定义的菜单项列表，包含枚举值，中文标题名,[{id:xxx, enum:0, title:水情信息},{...}] 
  * 参数：
	* platformId,平台id
  * 返回：
    * OK, 行政区(公众号)下设置的菜单列表,如果没有设置，返回空数组
9. 新建公众号菜单,/weChat/systemAdmin/menu/web/create,POST
   * web端
   * 角色，系统管理员
   * 新建的菜单中的menu必须是没有使用过的，如果使用过返回DATA_EXIST
   * 参数：
     * platformId,平台id
     * title:菜单标题，如市级动态，市级台账等 
     * menu:菜单枚举0-3数字
   * 返回：
     * OK,新建成功
     * DATA_EXIST,对应菜单已经存在，不能重复新建
10. 修改公众号菜单,/weChat/systemAdmin/menu/web/update,POST
  * web端
  * 角色，系统管理员
  * 参数：
     * id:菜单id
     * title:菜单标题，如市级动态，市级台账等
  * 返回：
     * OK,修改成功
     * DATA_NOEXIST,菜单不存在
11. 删除公众号菜单,/weChat/systemAdmin/menu/web/delete/{id},DELETE
  * web端
  * 角色，系统管理员
  * 参数：
     * id:菜单id
  * 返回：
     * OK,删除成功
     * DATA_NOEXIST,菜单不存在          
12. 取得系统内菜单项列表, /weChat/systemAdmin/menu/lists ,GET
  * web
  * 角色，系统管理员
  * 返回系统内菜单项列表，包含枚举值，中文默认标题名,[{enum:0, title:新闻动态},...]  
  * 用于在添加菜单时，显示所有菜单下拉项      
  * 参数：无
  * 返回：
     * OK,返回菜单项列表       

## 十 河长 HzUserController
1. 登录发送验证码: /hzUser/login/getLoginVerify,GET
    * **app端使用**
    * **角色：无**
    * 河长登录时，取得验证码
    * 河长对应的行政区不在 平台 范围内，返回DATA_NOEXIST
    * 参数：
        * phone:登录手机号
        * platformId：平台id 
    * 返回：
        * OK:发送成功
        * 4012: DATA_NOEXIST, 手机号不存在
2. 登录：/hzUser/login,POST
    * **app端使用**
    * **角色：无**
    * 河长每次登录都是用动态验证码    
    * 参数：
        * code:验证码 
    * 返回:
        * OK:登录成功,返回河长详情，管辖的河段 {name:xx,regionId,regionName,phone:xx,job:xx,type:xx,riverSegments:[{id,name:xx,length:xx,beginStation:xx,endStation:xx,riverName:xx,regionId,regionName:xx},{...}], qqslBucket:xxx, qqslimageBucket:xxx, weChatMenus:[{enum:0, title:新闻动态},{}], articleMenus:[{enum:0, title:新闻动态},{...}]}
        * 4041: CODE_INVALID 验证码过期
        * 4042: CODE_ERROR 验证码输入错误
3. 取得河长数量，/hzUser/num,GET
   * **weChat,web端使用**
   * **角色：无**
   * 参数：
       * platformId:平台id    
   * 返回： 
       * OK，格式:{regionId:xxx,master(总河长):xxx,slave(副总河长):xxx,city:34,county:123,town:xxx,villlage:xxx, hzUsers:[{name:xxx,job:xxx,riverSegments:[{id:xxx,name:xxx}]}, {...}]}   
5. 取得下级行政区列表及河长数量，/hzUser/region/down/lists,GET
   * **weChat,web端使用**
   * **角色：无**
   * 取得下级行政区列表，包含行政区名称，河长数量
   * level的含义：city, county, town, village
   * 如果level的级别比regionId对应的级别高，就使用本级级别
   * 参数：
       * regionId：行政区Id
       * level: 行政级别的英文名
   * 返回：
       * OK,格式：[{id:xxx,name:xxx,num:xxx},{...}]        
6. 取得行政区下河长及管理河道列表，/hzUser/hzUserInfo/lists,GET
      * **weChat,web端使用**
      * **角色：无**
      * 取得行政区下河长和河长管理的河道信息，河道信息riverSegments，是个字符串，把河道名称用逗号组合起来
      * 参数：
          * regionId：行政区id    
      * 返回:
          * OK,格式：[{name:xxx,job:xxx,riverSegments:[{id:xxx,name:xxx}]}, {...}]
4. 门户取得行政区下河长列表，/hzUser/portal/lists,GET
   * **角色：无**
   * 取得行政区下级河长列表，河道信息riverSegments，是个字符串，把河道名称用逗号组合起来
   * 比如取得西宁市，返回的是西宁下所有县区，乡，村河长列表
   * 参数：
       * platformId:平台id 
       * level: 级别，所有，市级，县级，乡级，村级       
   * 返回:
       * OK,格式：[{name:xxx,job:xxx,level:xxx,levelC:xxx,riverSegments:[{id:xxx,name:xxx}]}, {...}]           

## 十一 ComplaintControler，投诉
1. 公众号提交投诉,/complaint/weChat/submit,POST
    * **weChat使用**
    * **角色：weChat** 
    * 投诉实体中增加imageUrl，上传图片时，把第一张图的地址保存在imageUrl中
    * 参数：
        * title：标题，必需
        * description：描述，由几组关注信息自动组成的，必需
        * content：投诉内容，必需
        * coor:由网页定位识别的经纬度，必需
        * address:由网页定位识别的位置，必需
        * riverSegmentId:选择的河段id，必需
        * riverSegmentName:选择的河段名，必需
        * name:投诉人姓名，可以使匿名
        * @ phone:投诉人电话
        * instanceId:唯一标识
        * mediaIds: "xx,xx,.."
        * unionId，微信唯一标识
    * 返回：
        * OK，建立成功，与登录的user关联
2. 手机app提交投诉,/complaint/phone/submit,POST
    * **app端使用**
    * **角色：weChat** 
    * 参数：
        * title：标题，必需
        * description：描述，由几组关注信息自动组成的，必需
        * content：投诉内容，必需
        * coor:由网页定位识别的经纬度，必需
        * address:由网页定位识别的位置，必需
        * riverSegmentId:选择的河段id，必需
        * riverSegmentName:选择的河段名，必需
        * name:投诉人姓名，可以使匿名
        * @ phone:投诉人电话
        * instanceId:唯一标识
        * imageUrl:封面图片
        * unionId，微信唯一标识
    * 返回：
        * OK，建立成功，与登录的user关联        
3. 公众号取得微信用户的投诉列表，/complaint/weChat/lists,GET
    * **weChat**
    * **角色：weChat** 
    * 参数：
        * unionId，微信唯一标识
    * 返回：
        * OK，返回投诉列表，只需返回id，createDate, title，imageUrl，riverSegmentName, status,handleName, handleDate
4. 门户取得投诉列表,/complaint/portal/lists,GET
    * **角色：无
    * 增加内容缩略 introduce，内容前100个字
    * 参数：
        * platformId，平台id
    * 返回：
        * OK，返回投诉列表，只需返回id，createDate, title, introduce, coor, imageUrl，riverSegmentName, status,handleName, handleDate
5. 门户取得最新投诉列表，/complaint/portal/new/list,GET
    * **角色：无
    * 投诉内容要发过来,取得最新的五个投诉
    * 参数：
        * platformId，平台id
    * 返回：
        * OK，返回投诉列表，只需返回id，createDate, title, content, coor, imageUrl，riverSegmentName, status,handleName, handleDate        
4. 取得投诉列表:/complaint/hzb/lists,GET
    * **web端使用**
    * **角色：市河长办** 
    * 参数：无
    * 返回：
        * OK，返回投诉列表，只需返回id，createDate, name, phone, title，imageUrl，riverSegmentName, status, handleName, handleDate
5. 取得投诉详情，/complaint/complaint,GET
    * **weChat, web端使用**
    * **角色：无** 
    * 投诉实体中增加imageUrl，保存第一张图的地址
    * 参数：
        * instanceId:投诉唯一标识
    * 返回：
        * OK，投诉所有属性
        * FAIL，唯一标识不存在
        * 4022，DATA_REFUSE，请求的投诉不属于自己
6. 回复投诉反馈，/complaint/handle,POST
    * **web端使用**
    * **角色：河长办用户** 
    * 如果投诉的 platformId 和session中保存的 platformId 不一致，返回错误
    * 参数：
        * id,投诉id
        * handleName,处理人姓名
        * handleContent,回复内容
    * 返回：
        * OK,回复成功        
        * 4022: DATA_REFUSE 投诉不属于河长办 
7. 编辑反馈回复，/complaint/handle/update,POST
    * **web端使用**
    * **角色：河长办用户** 
    * 如果投诉的 platformId 和session中保存的 platformId 不一致，返回错误
    * 参数：
        * id,投诉id
        * handleName,处理人姓名
        * handleContent,回复内容
    * 返回：
        * OK,编辑成功        
        * 4022: DATA_REFUSE 投诉不属于河长办  
8. 编辑器上传回复图片，/complaint/image/create,POST
    * **web端使用**
    * **角色：河长办用户** 
   * 前台编辑器上传图片时调用后台接口，把图片上传到阿里云的qqslimage/hzy/{regionCode}/complaint/handle/，投诉处理图片中，上传时使用https://www.cnblogs.com/jdonson/archive/2009/07/22/1528466.html 方式生成图片的唯一编码
    * 上传时对图片进行压缩，以便用户能快速浏览，参见https://blog.csdn.net/niuch1029291561/article/details/17377903 ,压缩到图片宽度600px
    * 参数： 
    * 使用HttpServletRequest request，转换为MultipartHttpServletRequest multiRequest = (MultipartHttpServletRequest) request，取得图片，参见 https://blog.csdn.net/qq_24419601/article/details/79784773
    * 返回:
        * OK,数据：{"fileName":"文件名.文件格式","url":"上传成功后得资源路径url"} ,资源路径url是阿里云的路径
        * FAIL
9. 河长根据河段取得诉列表，/complaint/riverSegment/lists,GET
    * **app**
    * **角色：河长** 
    * 参数：
        * riverSegmentId:河段id
    * 返回：
        * OK，返回投诉列表，只需返回id，createDate, title，imageUrl，riverSegmentName, status,handleName, handleDate  
        
## 十二 ArchiveController,一河一档控制层
1. 门户取得一河一档列表,/archive/weChat/archive/lists,GET
    * **角色：无**   
    * 增加 introduce 字段，内容缩略100字
    * 增加 riverId 字段
    * 参数：
       * platformId:平台id
    * 返回：
        * OK,返回一河一档列表,每个对象包含所有一河一档属性，保证有新建时间
2. 取得一河一档列表,/archive/archive/lists,GET
    * **app端使用**
    * **角色：所有登录有session的人员**
    * 根据session中的platformId,取得列表
    * 增加 introduce 字段，内容缩略100字
    * 增加 riverId 字段
    * 参数：无
    * 返回：
        * OK,返回一河一档列表,每个对象包含所有一河一档属性，保证有新建时间
3. 门户取得一河一档，/archive/portal/details/{id}, GET
   * **角色：无**
   * 返回：
	 * OK，返回河流(水资源)所有属性，河湖档案的所有属性，基础属性
     * DATA_NOEXIST,河流不存在
	 * DATA_REFUSE, 不是本平台的河流，不能查看    
9. 取得河湖档案全部属性,/archive/archive/details/{id},GET
   * **角色：所有登录系统的人员，只要有session**
   * 参数： id：河流id
   * 返回：
	 * OK，返回返回河流(水资源)所有属性，河湖档案的所有属性，河湖档案下所有属性(基础+动态)，根据xml配置的结构返回json
     * DATA_NOEXIST,河流不存在	  
        
 
## 十三  ArticleController 新闻动态和政策方案 
 1. 取得新闻动态列表,/article/newses,GET
     * **weChat,web端使用**
     * **角色：无**   
     * 参数：
         * platformId
     * 返回：
         * OK，所属行政区的新闻动态列表，增加 introduce 内容缩略100个字
         * FAIL，行政区不存在
 3. 取得新闻动态详情,/article/article/{id},GET
     * **weChat,web端使用**
     * **角色：无**    
     * 参数：id: 新闻动态id
     * 返回：
         * OK，新闻动态所有属性
         * FAIL，id不存在
 4. 新建文章，/article/admin/create, POST
     * **web端使用**
     * **角色：河长办管理员**    
     * 河长办用户操作，参数中不需要 platformId，因为session中有这个信息  
     * 参数： 
         * title,文章标题
         * content，文章内容
         * imageUrl，图片
         * menu: 0-3枚举值
     * 返回:
         * OK,保存成功
 5. 修改文章，/article/admin/update, POST
     * **web端使用**
     * **角色：河长办管理员**    
     * 参数： 
         * id,新闻动态id
         * title,文章标题        
         * content，文章内容
         * imageUrl，图片
         * menu，0-3枚举值
     * 返回:
         * OK,保存成功
 6. 上传文章图片，/article/image/create POST
     * **web端使用**
     * **角色：河长办管理员**    
     * 前台编辑器上传图片时调用后台接口，把图片上传到阿里云的qqslimage/hzy/{regionCode}/article/中，上传时使用 https://www.cnblogs.com/jdonson/archive/2009/07/22/1528466.html 方式生成图片的唯一编码
     * 上传时对图片进行压缩，以便用户能快速浏览，参见https://blog.csdn.net/niuch1029291561/article/details/17377903 ,压缩到图片宽度600px
     * 参数： 
     * 使用HttpServletRequest request，转换为MultipartHttpServletRequest multiRequest = (MultipartHttpServletRequest) request，取得图片，参见https://blog.csdn.net/qq_24419601/article/details/79784773
     * 返回:
         * OK,数据：{"fileName":"文件名.文件格式","url":"上传成功后得资源路径url"} ,资源路径url是阿里云的路径
         * FAIL
  7. **`删除文章，/article/delete，POST`**
     * **web端使用**
     * **角色：河长办管理员**   
     * 参数： 
         * id: 文章id
     * 返回:
         * OK,删除成功
         * 4022，DATA_REFUSE，文章不属于自己
         
~~~
        BILLBOARD("公示牌"),
        RESERVOIR("水库"),
        IRRIGATION("灌区"),
        INTAKE("取水口"),
        DRINKING_WATER_SOURCES("饮用水源地"),
        OUTLET("排污口"),
        SEWAGE_FACTORY("污水处理厂"),
        FIRST_GRADE_WATER_FUNCTION("一级水功能区"),
        SECOND_GRADE_WATER_FUNCTION("二级水功能区"),
        WHARF("港口码头"),
        BANK_PROTECTION("堤岸护坡"),
        BARRIER_GATE("拦河闸"),
        PUMPING_STATION("泵站"),
        POWER_STATION("水电站"),
        RUBBER_DAM("橡胶坝"),
        ROLLING_DAM("滚水坝"),
        NAVIGATION_BUILDING("通航建筑物"),
        BRIDGE("桥梁"),
        CULVERT("涵洞"),
        TUNNEL("隧洞"),
        AQUEDUCT("渡槽"),
        ECOLOGICAL_PROTECTED_AREAS("生态保护区"),
        WETLAND_PARK_ALONG_LAKE("沿湖湿地公园"),
        AQUATIC_BIOLOGICAL_RESERVE("水生生物保护区"),
        LEVEE("堤防"),
        SLUICE("水闸"),
        NATURE_AND_CULTURAL_RESOURCES_RESERVE("自然文化资源保护区"),
        NATIONAL_KEY_ECO_FUNCITIONAL_AREAS("国家重点生态功能区"),
        NATIONAL_KEY_SCENIC_SPOTS("重点风景名胜区");
~~~

~~~
行政区枚举:
    /**
     * 行政区级别
     */
    public enum RegionLevel {
        // 省
        PROVINCE,
        // 市
        CITY,
        // 县
        COUNTY,
        // 乡
        TOWN,
        // 村
        VILLAGE,
        // 所有
        ALL       
    }
河长枚举:
    /**
     * 河长级别
     */
    public enum HzType {
        // 总河长
        MASTER,
        // 副总河长
        SLAVE,
        // 河长
        NORMAL
    }  
~~~