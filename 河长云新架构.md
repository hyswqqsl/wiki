# 河长云新架构接口

## 河长云类结构

![新架构](/uploads/80ef9aa007ab35e15298e074991d929c/新架构.jpg)

## 河长云成员单位详情

![Main1](/uploads/7f32483b64a8990877b3eaddd87f9aa4/Main1.png)

## 一 系统管理员，SystemAdminController 
1. 登录发送验证码: /systemAdmin/login/getLoginVerify,GET
   * **角色：无**
   * 系统管理员登录时，取得验证码
   * 参数：
      * phone:登录手机号
   * 返回：
      * OK:发送成功
      * DATA_NOEXIST:账号不存在
2. 登录：/systemAdmin/login,POST
   * **角色：无**
   * 每次登录都是用动态验证码
   * 参数：
      * verification:验证码
   * 返回:
      * OK:成功成功
      * 4041: CODE_INVALID 验证码过期
      * 4042: CODE_ERROR 验证码输入错误
3. 取得系统管理员，/systemAdmin/getUser,GET
   * **角色：无**
   * 参数：
   * 返回：
      * OK(系统管理员对象)，包含系统员属性和角色
      * 4011: NO_SESSION,未登录
4. 系统管理员注销,/systemAdmin/logout POST
   * **角色：系统管理员**
   * 参数：无
   * 返回：OK,注销成功
                

## 二 平台，PlatformController
1. 新建平台，/platform/systemAdmin/create, POST
   * **角色：系统管理员**
   * 参数:
     * name: 平台名称
     * regionCode：对应的行政区编码
     * type: 平台类型，FULL_PLATFORM：完整，WECHAT_PLATFORM： 微信公众号
     * appId: 微信appId
     * appSecret: 微信appSecret
   * 返回:
     * OK，新建成功
     * DATA_EXIST: 对应的行政区已有平台，或appId已使用
2. 取得平台列表, /platform/systemAdmin/list, GET
   * **角色：系统管理员**
   * 参数: 无
   * 返回：
     * OK，返回数组，每项包含平台中所有属性
3. 编辑平台, /platform/systemAdmin/edit, POST
   * **角色：系统管理员**
   * 参数:
     * id: 平台id
     * name: 平台名称
     * regionCode：对应的行政区编码
     * type: 平台类型，FULL_PLATFORM：完整，WECHAT_PLATFORM： 微信公众号
     * appId: 微信appId
     * appSecret: 微信appSecret
   * 返回:
     * OK，编辑成功
     * DATA_NOEXIST: 平台不存在
     * DATA_EXIST: 对应的行政区已有平台，或appId已使用
     * DATA_LOCK: 平台下已有行政区结构，不能修改行政区编码
4. 删除平台, /platform/systemAdmin/delete{id}，DELETE
   * **角色：系统管理员**
   * 平台下如果有河流，水资源，行政区，公众号号菜单，新闻菜单，新闻动态，通报，不能删除
   * 参数: id
   * 返回:
	 * OK，删除成功
	 * DATA_NOEXIST,平台不存在
	 * DATA_LOCK, 平台下有数据，不能删除

## 三 河流，RiverController
1. 新建河流节点，/river/systemAdmin/node/create,POST
   * **角色：系统管理员**
   * 如果是顶级节点，如西宁平台的湟水河，pId为0
   * level 河流级别,根据上级河流节点自动确定 0-一级 1-二级 2-三级 3-四级
   * 参数：
     * platformId，平台id
     * pId,父级节点id
     * name,节点名
   * 返回：
      * OK: 新建成功,返回新建的节点{id:xx,name:xxx,pId:xxx}
      * DATA_NOEXIST: 平台或父节点不存在
2. 取得ZTree河湖json,/river/systemAdmin/tree,GET
   * **角色：系统管理员**
   * 参数: 
      * platformId: 平台id 
   * 返回：
      * OK,返回河流zTree使用的json 
3. 编辑河流节点，/river/systemAdmin/node/update,POST
   * **角色：系统管理员**
   * 参数：
     * id,节点id
     * name,节点名
     * code,编码
     * level: 河流级别
     * remark,备注
   * 返回：
     * OK: 编辑成功
     * DATA_NOEXIST: id不存在 
     * DATA_LOCK: 有子节点，不能编辑河流级别
4. 删除河流节点，/river/systemAdmin/node/delete/{id},DELETE
   * **角色：系统管理员**
   * 如果节点不是叶子节点，不能删除
   * 如果下面有河湖档案，不能删除
   * 如果河流下有河段划分，不能删除
   * 参数：
     * id,节点id
   * 返回:
     * OK,删除成功
     * DATA_NOEXIST,id不存在
     * FAIL，删除失败，河流下有数据
5. 取得河流详情: /river/systemAdmin/details/{id}, GET
   * **角色：系统管理员**
   * 参数： id：河流id
   * 返回：
     * OK，返回河流所有屬性
     * DATA_NOEXIST,河流不存在
6. 河长办得zTree相关河流json,/river/tree,GET
   * **角色：河长办人员**
   * 河长办人员登陆后,要把平台id存在session中,取得河流zTree时,使用平台id 
   * 角色：市，县河长办管理员
   * 参数: 无
   * 返回：
     * OK,返回zTree河流json
5. 河长办取得河流详情: /river/details/{id}, GET
   * **角色：河长办人员**
   * 参数： id：河流id
   * 返回：
     * OK，返回河流所有屬性
     * DATA_NOEXIST,河流不存在
	 * DATA_REFUSE, 不是本平台的水资源，不能查看	 
	 

## 四 水资源，WaterResourceController
1. 新建水资源, /waterResource/systemAdmin/create, POST
   * **角色：系统管理员**
   * 参数：
     * platformId：平台id
     * name,节点名
     * type: 湖泊，LAKE，水库，RESERVOIR，水源地，WATER_PLACE，灌区，IRRIGATION_AREA
     * remark,备注
   * 返回：
     * OK: 新建成功
     * DATA_NOEXIST: 平台不存在
2. 取得水资源列表, /waterResource/systemAdmin/list, GET
   * **角色：系统管理员**
   * 参数：
     * platformId: 平台id
   * 返回:
     * OK, 返回水资源数组，每项包含所有属性
3. 编辑水资源， /waterResource/systemAdmin/edit, POST
   * **角色：系统管理员**
   * 参数：
     * id: 水资源id
	 * name, 节点名
	 * type: 湖泊，LAKE，水库，RESERVOIR，水源地，WATER_PLACE，灌区，IRRIGATION_AREA
	 * remark: 备注
	 * riverId: 河流id
   * 返回：
	 * OK： 编辑成功
	 * DATA_NOEXIST: 水资源或河流不存在
	 * DATA_LOCK: 已建立河湖概况，不能编辑类型
4. 删除水资源,/waterResource/systemAdmin/delete/{id}, DELETE
   * **角色：系统管理员**
   * 如果水资源下有河湖档案，或有河湖段划分，不能删除
   * 参数：id
   * 返回：
	 * OK，删除成功
	 * DATA_NOEXIST: 水资源不存在
	 * DATA_LOCK: 水资源下有数据,不能删除
5. 取得水资源详情, /waterResource/systemAdmin/details/{id}, GET
   * 角色：系统管理员
   * 参数：id, 水资源id
   * 返回：
	 * OK，返回水资源所有属性
	 * DATA_NOEXIST, 水资源不存在
6. 河长办取得水资源列表, /waterResource/list, GET
   * 角色：河长办人员
   * 河长办人员登陆后,要把平台id存在session中,取得河流zTree时,使用平台id
   * 参数: 无
   * 返回:
	 * OK, 返回水资源列表
7. 河长办取得水资源详情, /waterResource/details/{id},GET
   * 角色：河长办人员
   * 参数：id, 水资源id
   * 返回：
	 * OK，返回水资源所有属性
	 * DATA_NOEXIST, 水资源不存在
	 * DATA_REFUSE, 不是本平台的水资源，不能查看
	 
## 五 行政区, RegionController
1. 新建行政区节点，/region/systemAdmin/node/create,POST
   * **角色：系统管理员**
   * 如果是顶级节点，如西宁平台的西宁市节点，pId为0
   * 如果不是父节点，name新建的节点级别默认是父节点的下一级
   * 参数：
	 * platformId, 平台id 
	 * pId,父级节点id
	 * name,节点名
   * 返回：
	 * OK,新建成功,返回新建的节点{id:xx,name:xxx,pId:xxx}
	 * DATA_NOEXIST: 平台或父节点不存在
2. 系统管理员取得行政区zTree结构json，/region/systemAdmin/tree,GET
   * **角色：系统管理员**
   * 得到前台显示用的region属性结构json串
   * 参数：
	 * platformId: 平台id
   * 返回：
	 * OK，zTree的json串
	 * DATA_NOEXIST 平台不存在 		
3. 系统管理员修改行政区节点，/region/systemAdmin/node/update,POST
   * **角色：系统管理员**
   * 参数：
	 * id,节点id
	 * name,节点名
	 * code,编码
	 * level,级别
	 * remark,备注
   * 返回：
	 * OK,修改成功
	 * DATA_NOEXIST,id不存在
	 * DATA_LOCK, 有子节点，不能编辑级别
	 * DATA_REFUSE, 级别高于父节点，级别设置错误
4. 系统管理员删除行政区节点，/region/systemAdmin/node/delete/{id},DELETE
   * **角色：系统管理员**
   * 如果节点不是叶子节点，不能删除
   * 如果下面有河长，责任单位，不能删除
   * 参数：
	 * id,节点id
   * 返回:
	 * OK,删除成功
	 * DATA_NOEXIST,id不存在
	 * DATA_LOCK，删除失败，行政区下有数据
5. 系统管理员取得行政区详情，/region/systemAdmin/details/{id},GET
   * **角色：系统管理员**
   * 参数：
	 * id,行政区id
   * 返回:
	 * OK,行政区所有属性,行政区所有属性，新闻菜单列表，公众号菜单列表
	 * DATA_NOEXIST,行政区不存在
6. 河长办得zTree结构json，/region/tree,GET
   * 角色：河长办人员
   * 得到前台显示用的region属性结构json串
   * 河长办人员登陆后,要把平台id存在session中,取得行政区zTree时,使用平台id
   * 参数：无
   * 返回：
	 * OK，zTree的json串
7. 河长办管理员取得行政区详情，/region/details/{id},GET
   * 角色：河长办人员
   * 参数：
	 * id,行政区id
   * 返回:
	 * OK,行政区所有属性,河长列表，河长办，河长办用户列表，责任单位类别
	 * DATA_NOEXIST,行政区不存在
	 * DATA_REFUSE,不是本平台的政区，不能查看
      
