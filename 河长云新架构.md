# 河长云新架构接口

## 一 系统管理员，SystemAdminController 
1. 登录发送验证码: /systemAdmin/login/getLoginVerify,GET
   * **角色：无**
   * 系统管理员登录时，取得验证码
   * 参数：
       * phone:登录手机号
   * 返回：
       * OK:发送成功
       * DATA_NOEXIST:账号不存在
2. 登录：/systemAdmin/login,POST
   * **角色：无**
   * 每次登录都是用动态验证码    
   * 参数：
       * verification:验证码
   * 返回:
       * OK:成功成功
       * 4041: CODE_INVALID 验证码过期
       * 4042: CODE_ERROR 验证码输入错误
3. 取得系统管理员，/systemAdmin/getUser,GET
    * **角色：无**
    * 参数：
    * 返回：
       * OK(系统管理员对象)，包含系统员属性和角色
       * 4011: NO_SESSION,未登录       
4. 系统管理员注销,/systemAdmin/logout POST
   * **角色：系统管理员**
   * 参数：无
   * 返回：OK,注销成功       
                                

## 二 平台，PlatformController
1. 新建平台，/platform/systemAdmin/create, POST
   * **角色：系统管理员**
   * 参数:
      * name: 平台名称
      * regionCode：对应的行政区编码
      * type: 平台类型，PLATFORM：平台级，WECHAT： 微信公众号级
      * appId: 微信appId
      * appSecret: 微信appSecret
   * 返回:
      * OK，新建成功
      * DATA_EXIST: 对应的行政区已有平台，或appId已使用
2. 取得平台列表, /platform/systemAdmin/list, GET
   * **角色：系统管理员**
   * 参数: 无
   * 返回：
      * OK，返回数组，每项包含平台中所有属性
3. 编辑平台, /platform/systemAdmin/edit, POST
   * **角色：系统管理员**
   * 参数:
      * id: 平台id
      * name: 平台名称
      * regionCode：对应的行政区编码
      * type: 平台类型，PLATFORM：平台级，WECHAT： 微信公众号级
      * appId: 微信appId
      * appSecret: 微信appSecret
   * 返回:
      * OK，编辑成功
      * DATA_NOEXIST: id不存在                   
      * DATA_EXIST: 对应的行政区已有平台，或appId已使用
      * DATA_LOCK: 平台下已有行政区结构，不能修改行政区编码

## 三 河流编辑接口，RiverController
1. 取得ZTree河湖json,/river/systemAdmin/lists,GET
   * **角色：系统管理员**
   * 参数: 
       * platformId: 平台id 
   * 返回：
       * OK,返回河流zTree使用的json
2. 新建河流节点，/river/systemAdmin/node/create,POST
   * **角色：系统管理员**
   * 如果是顶级节点，如西宁平台的湟水河，pId为0
   * level 河流级别,根据上级河流节点自动确定 0-一级 1-二级 2-三级 3-四级           
   * 参数：
      * platformId，平台id  
      * pId,父级节点id
      * name,节点名
   * 返回：
       * OK: 新建成功,返回新建的节点{id:xx,name:xxx,pId:xxx}
       * DATA_NOEXIST: pId不存在
3. 编辑河流节点，/river/systemAdmin/node/update,POST
   * **角色：系统管理员**  
   * 参数：
      * id,节点id
      * name,节点名
      * code,编码
      * level: 河流级别
      * remark,备注
   * 返回：
      * OK: 编辑成功
      * DATA_NOEXIST: id不存在  
      * DATA_LOCK: 有子节点，不能编辑河流级别           
4. 删除河流节点，/river/systemAdmin/node/delete/{id},DELETE
   * **角色：系统管理员**
   * 如果节点不是叶子节点，不能删除
   * 如果下面有一河一档，不能删除
   * 如果河流下有河段划分，不能删除
   * 参数：
      * id,节点id
   * 返回:
      * OK,删除成功
      * DATA_NOEXIST,id不存在
      * FAIL，删除失败，河流下有数据
6. 取得河流详情: /river/systemAdmin/details/{id}, GET
   * **角色：系统管理员**
   * 参数： id：河流id
   * 返回：
      * OK，返回河流所有屬性
      * DATA_NOEXIST,河流不存在      
6. 河长办管理员取得zTree相关河流json,/river/admin/hzb/lists,GET
   * web端使用
   * 河长办人员登陆后,要把平台id存在session中,取得河流zTree时,使用平台id 
   * 角色：市，县河长办管理员
   * 参数: 无
   * 返回：
      * OK,返回zTree河流json


     
      
