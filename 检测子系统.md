# 监测子系统接口设计

![8E298BC0-AADE-409F-8B61-E3E846BA54EC](/uploads/7dcf20713b37e17cc6e78a1316e26a8a/8E298BC0-AADE-409F-8B61-E3E846BA54EC.png)


![8E298BC0-AADE-409F-8B61-E3E846BA54EC](/uploads/6095e9d9d712c90a6da55de19556b87a/8E298BC0-AADE-409F-8B61-E3E846BA54EC.png)


## 一 监测子系统，SensorController，仪表控制层
1. 取得仪表列表, /sensor/lists, GET
    * 水利云后台访问监测
    * 参数：
        * token: 用于验证用户身份，使用对称加密算法
    * 返回:
        * OK:仪表列表，所有属性    
        * 4010: UNAUTHORIZED 无访问权限，token未通过验证
2. 取得仪表当天数据，/sensor/data/day, GET
    * 水利前台访问监测
    * 监测根据code，token和noticeStr向水利云后台验证用户身份，code是够属于用户
    * token一次验证失效
    * 参数：
        * token: 用于验证用户身份，使用对称加密算法
        * noticeStr,随机码
        * code：仪表唯一编码
    * 返回：
        * OK:仪表数据列表，仪表数据(sensorData)所有属性
        * 4010: UNAUTHORIZED 无访问权限，仪表数据不属于这个token中标识的用户
3. 取得仪表数据,/sensor/data, GET
    * 水利前台访问监测
    * 如果查询时间超过1个月，每1小时返回1条数据
    * 监测根据code，token和noticeStr向水利云后台验证用户身份，code是够属于用户
    * token一次验证失效    
    * 参数：
        * token: 用于验证用户身份，使用对称加密算法
        * noticeStr,随机码
        * code：仪表唯一编码
        * beginDate: 开始时间
        * endDate: 结束时间
    * 返回：
        * OK:仪表数据列表，仪表数据(sensorData)所有属性
        * 4010: UNAUTHORIZED 无访问权限，仪表数据不属于这个token中标识的用户
        
## 二 监测子系统 RiverStationController
1. 取得监测站lists，/riverStation/lists,GET
    * 监测访问水利云后台
    * 参数：无
    * 返回：
        * OK，返回监测站所有属性列表
2. 取得监测站一月内数据，/riverStation/data/month/{code},GET
    * 监测访问水利云后台
    * 参数：
        * code，监测站唯一编码
    * 返回：
        * OK，根据当前时间，返回一个月内数据，比如：6月5日至7月5日
        * DATA_NOEXIST，code不存在

## 三 水利云后台 StationController
1. 获取token,/station/token,GET
    * 监测访问水利云后台
    * 这个接口返回的token包含用户信息，可以在水云端验证用户身份
    * 参数：无
    * 返回：
        * ok,data:{"token":"","noticeStr":""}
        * NO_SESSION   
2. 效验token,/station/intendedEffectToken,GET
    * 参数：
        * code：仪表唯一编码
        * token：token
        * noticeStr：随机码
    * 返回：
        * OK：成功
        * UNAUTHORIZED：无权限             
3. **监测取得测站参数：/station/getParameters，GET**
    * 监测访问水利云后台
    * 这是监测系统取得所有已改变的参数列表
    * 这个token是监测自己生产的，用于确定身份
    * 参数：token
    * 返回：
        * OK：返回包含测站唯一编码，测站名，所有仪表编码，以及参数，格式：`[{instanceId:xx,name:xxx,sensors:[{code:xx},{code:xx}],parameters:(json)}, {...}]`
        * FAIL,token失效

## 四 水利云后台，OssController
1. 取得监测子系统取得欲转换的office文件列表,/oss/transform/lists,GET **原路径/oss/list**
    * 这个token是水利云后台自己生产的，用于确定身份
    * 参数：token
    * 返回：
        * OK,返回列表
        * FAIL,token失效
2. 删除已经转换成功的记录，/oss/transform/remove，POST，**原路径/oss/remove**
    * 这个token是水利云后台自己生产的，用于确定身份
    * 参数：token
    * 返回：
        * OK,删除成功
        * FAIL,token失效  
        
## 五 同仁施工现场前台接口 ConstructionController
1. 根据时间段获取时间点列表，/construction/lists,GET
    * 前台从后台取得token，noticeStr，发给监测
    * 监测根据token和noticeStr向水利云后台验证用户身份
    * token一次验证失效
    * 参数：
        * token,noticeStr: token和随机串
        * beginDate: 开始时间
        * endDate: 结束时间        
        * code：门禁唯一编码
    * 返回：
        * OK,返回列表数据，[{id:xxx,date:xx(long)}, {...}]
        * FAIL,token失效
2. 获取当前施工现场数据，/construction/current/details,GET         
    * 前台从后台取得token，noticeStr，发给监测
    * 监测根据token和noticeStr向水利云后台验证用户身份
    * token一次验证失效
    * 参数：
        * token,noticeStr: token和随机串
        * code：门禁唯一编码
    * 返回：
        * OK,返回施工现场数据，{works:[{...},{...}], trucks:[{...},{...}]}
        * FAIL,token失效
3. 获取确定时间点施工现场数据，/construction/date/details,GET
    * 前台从后台取得token，noticeStr，发给监测
    * 监测根据token和noticeStr向水利云后台验证用户身份
    * token一次验证失效
    * 参数：
        * token,noticeStr: token和随机串
        * code：门禁唯一编码
        * id: 记录id
    * 返回：
        * OK,返回时间点的施工现场数据，{works:[{...},{...}], trucks:[{...},{...}]}
        * FAIL,token失效
        
